class MutationObserverRegistry{constructor(t){this.functionsForAnyMutation=[],this.functionsForNodeAddition=[],this.observerName=t}addFunctionForAnyMutation=t=>this.functionsForAnyMutation.push(t);addFunctionForNodeAddition=t=>this.functionsForNodeAddition.push(t);observer=new MutationObserver((t=>{const e=Date.now();for(let e in t){let n=t[e];if(n.addedNodes&&n.addedNodes.length>0){let t=Array.from(n.addedNodes);for(let e in t){let n=t[e];for(let t in this.functionsForNodeAddition){(0,this.functionsForNodeAddition[t])(n,this.observerName)}}}for(let t in this.functionsForAnyMutation){(0,this.functionsForAnyMutation[t])(n,this.observerName)}}const n=Date.now();GLOBAL.totalTimeSpentInRolandUImodsScript+=n-e}))}class ConditionalFormatting{constructor(){this.textMatchStyles=JSON.parse(GLOBAL.settingsManager.settings.textMatchStyles)}run=()=>{GLOBAL.mutationObserverRegistry.addFunctionForAnyMutation(this.processMutation),GLOBAL.mutationObserverRegistry.addFunctionForNodeAddition(this.processTextNode),GLOBAL.mutationObserverRegistry.addFunctionForNodeAddition(this.accessLinkMod),GLOBAL.mutationObserverRegistry.addFunctionForNodeAddition(this.defectRequestMod)};processMutation=(t,e)=>{this.expandEmailInput(t),this.expandT3investigationActionTextInput(t),this.monitorActiveCaseWhenUrlChanges(t),this.listenForAttachedImages(t),this.applyFeedFont(t)};applyFeedFont=t=>{if(GLOBAL.settingsManager.settings.overrideStandardFeedFont){const e=$(t.target),n=GLOBAL.settingsManager.settings.customFeedFont.length>0?GLOBAL.settingsManager.settings.customFeedFont:GLOBAL.settingsManager.settings.feedFontFamily;if("emailuiFrame"==e.attr("id")){$(e.get(0).contentWindow.document).find("body").css({fontFamily:n,fontSize:`${GLOBAL.settingsManager.settings.feedFontSize}px`})}else if(e.hasClass("cuf-compactBody")){let t=e.find(".feedBodyInner");t.length>0&&t.css({fontFamily:n,fontSize:`${GLOBAL.settingsManager.settings.feedFontSize}px`})}else if(e.hasClass("cuf-element")){let t=e.find(".preamble_custom-summary");t.length>0&&t.css({fontFamily:n,fontSize:`${GLOBAL.settingsManager.settings.feedFontSize}px`});let i=e.find(".uiOutputText");i.length>0&&i.css({fontFamily:n,fontSize:`${GLOBAL.settingsManager.settings.feedFontSize}px`})}}};listenForAttachedImages=t=>{const e=$(t.target);if(e.hasClass("forceContentModalPreviewPlayer")){GLOBAL.imageContainerDiv=e.find("div.thumbnail img.pageImg").parent();let t=e.find("div.thumbnail img.pageImg").attr("src"),n=e.find("img.pageImg").attr("src");t&&GLOBAL.attachedImageUrls.push(t),GLOBAL.imageUrlResolvedCallback&&(t||n)&&GLOBAL.imageUrlResolvedCallback(t)}};expandT3investigationActionTextInput=t=>{const e=$(t.target);if(e.hasClass("ql-editor slds-rich-text-area__content slds-text-color_weak slds-grow")){e.css({maxHeight:"10000px"});let t=e.closest(".forceChatterMessageBodyInputRichTextEditor");t.length>0&&t.css({maxHeight:"10000px"})}};expandEmailInput=t=>{const e=$(t.target);if(e.hasClass("uiInput")){const t=e.find("iframe");if(t.length>0){const e="#cke_1_contents",n=$(t[0]).contents().find(e),i=$(t[0]).contents().find("iframe");if(i.length>0){const t=$(i[0]).contents().find("body");t.length>0&&(this.tampermonkeyLinkInQuickText(t),n.height(t.outerHeight()+20),GLOBAL.keyPressedOn=Date.now())}}}};tampermonkeyLinkInQuickText=t=>{let e=t.html();/\&lt;tampermonkeylink\&gt;.*?\&lt;\/tampermonkeylink\&gt;/.test(e)&&(e=e.replace(/\&lt;tampermonkeylink\&gt;/g,'<a href="'),e=e.replace(/\&lt;\/tampermonkeylink\&gt;/g,'">Tampermonkey link</a>'),t.html(e))};tryToFindFileLinks=()=>{console.log("trying to find links");let t=$("a:not('.tabHeader')[href*=\"/ContentDocument/\"] span.itemTitle.desktop");t.length>0&&(GLOBAL.fileLinks=t),console.log(t)};monitorActiveCaseWhenUrlChangesOld=()=>{if(window.location.pathname!=GLOBAL.pathname){GLOBAL.pathname=window.location.pathname,GLOBAL.fileLinks=null,console.log("links cleared"),this.tryToFindFileLinks();let t=GLOBAL.pathname.split("/");t.length>3&&"case"==t[t.length-3].toLowerCase()?GLOBAL.activeCaseId=t[t.length-2]:GLOBAL.activeCaseId=null,Object.keys(GLOBAL.caseIdNumberPairs).includes(GLOBAL.activeCaseId)&&(GLOBAL.activeCaseNumber=GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseId].caseNumber,this.highlightActiveCase())}};monitorActiveCaseWhenUrlChanges=()=>{if(window.location.pathname!=GLOBAL.pathname){GLOBAL.pathname=window.location.pathname;let t=GLOBAL.pathname.split("/");t.length>4&&"case"==t[3].toLowerCase()?(GLOBAL.activeCaseId!=t[4]&&GLOBAL.activeCaseId&&(GLOBAL.fileLinks=null,console.log("links cleared")),GLOBAL.activeCaseId=t[4]):GLOBAL.activeCaseId=null,Object.keys(GLOBAL.caseIdNumberPairs).includes(GLOBAL.activeCaseId)&&(GLOBAL.activeCaseNumber=GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseId].caseNumber,this.highlightActiveCase())}};highlightActiveCase=()=>{if(!GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseNumber].highlighted){for(let t in GLOBAL.caseIdNumberPairs)GLOBAL.caseIdNumberPairs[t].highlighted=!1;GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseNumber].highlighted=!0,$(".conditional-formatting-highlighted-case").css("background-color",""),$(".conditional-formatting-highlighted-case").removeClass(".conditional-formatting-highlighted-case");let t=GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseNumber].textNode,e=$(t).closest(".slds-split-view__list-item");if(e.length>0){let t=this.getStyleBasedOnTextArray(this.getTextFromNode(e.get(0)));if(t){let n=null!=t.bgColor?t.bgColor:"";for(let t in this.textMatchStyles){let e=this.textMatchStyles[t];if(e.text==GLOBAL.activeCaseStatus){n=e.bgColor;break}}e.addClass("conditional-formatting-highlighted-case"),e.css("background-color",n)}}}};getStyleBasedOnTextArray=t=>{for(let e in t){let n=t[e];for(let t in this.textMatchStyles){let e=this.textMatchStyles[t];if(e.text==n)return e}}return null};getTextFromNode=t=>{let e,n=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);for(;e=i.nextNode();)n.push(e.textContent);return n};processTextNode=t=>{const e=Date.now();let n,i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);for(;n=i.nextNode();)this.clickOnInternalOnly(n),this.color(n),this.gatherCaseIdNumberPairs(n),GLOBAL.settingsManager.settings.allUrlHyperlinkingBeta?this.allUrlHyperlinking(n):this.defectRequestIssueInTableHyperlinking(n),this.findFilesSection(n),this.findEscalatedToT3OrDevWarning(n),this.supportScoreHighlightInPanels(n),this.supportScoreInTableHighlighting(n),this.supportScoreInReportsHighlighting1(n),this.supportScoreInReportsHighlighting2(n),this.closeTheAccessLinkRequestPopup(n),this.changepointIdHyperlinking(n),this.agilePlaceIdHyperlinking(n),this.tasktopJiraIdHyperlinking(n),this.tasktopZendeskIdHyperlinking(n),this.tasktopJiraIdHyperlinkingManyIds(n),this.generalMessageIsNullHighlighting(n),this.milestonesCompleted(n),this.injectChatButton(n);const s=Date.now();GLOBAL.totalTimeSpent+=s-e};injectChatButton=t=>{if(GLOBAL.settingsManager.settings.enableChatModule&&"All Updates"==t.textContent){const e=$(t.parentNode).closest("ul.tabs__nav");e.length>0&&(null==GLOBAL.activeCaseId&&(GLOBAL.activeCaseId=GLOBAL.pathname.split("/")[4]),e.append(`<li id="roland-ui-mods-chat-button-${GLOBAL.activeCaseId}" role="presentation" class="roland-ui-mods-chat-button-general tabs__item uiTabItem" data-aura-rendered-by="7007:0" data-aura-class="uiTabItem" data-original-width="116"><a aria-selected="false" data-tab-name="ChangeStatusPost" role="tab" aria-controls="1149:3228;a" tabindex="-1" data-target-selection-name="ChangeStatusPostTab" title="Status Changes" class="tabHeader" data-aura-rendered-by="7008:0" ><span data-aura-rendered-by="7009:0"></span><span class="title" data-aura-rendered-by="7011:0">Chat!</span></a></li>`),GLOBAL.settingsManager.settings.defaultToChatModule&&$(`#roland-ui-mods-chat-button-${GLOBAL.activeCaseId}`).click())}};milestonesCompleted=t=>{if(GLOBAL.settingsManager.settings.hideEmptyMilestones&&"You completed all the milestones."==t.textContent){$(t.parentNode).closest(".supportMilestones").hide()}};generalMessageIsNullHighlighting=t=>{if("General Message"==t.textContent){let e=$(t.parentNode).closest("div.slds-form-element"),n=e.find("span.uiOutputTextArea");n.length>0&&n.text().length>0&&e.css({backgroundColor:"rgb(245, 183, 153)"})}};closeTheAccessLinkRequestPopup=t=>{if("Access Link Request"==t.textContent){let e=$(t.parentNode).closest("div.modal-container").find('button[title="Close this window"]');e.length>0&&e.click()}};displayTimeSpent=()=>{setTimeout((()=>{console.log("Time spent:",GLOBAL.totalTimeSpent),this.displayTimeSpent()}),1e3)};supportScoreHighlightInPanels=t=>{if("Support Score"==t.textContent){this.tryToHighlightSupportScoreInHighlightsPanel(t);let e=$(t.parentNode).closest("div.slds-form-element"),n=e.find("span.uiOutputNumber");this.supportScoreHighlight(e,n.html())}};querySelectorDeep(t,e){let n=e,i=t.split("::shadow"),s=n.querySelectorAll(i[0]);for(let t=1;t<i.length;t++){let e=i[t],n=[];for(let t=0;t<s.length;t++){let i=s[t].shadowRoot;if(i){const t=i.querySelectorAll(e);n=n.concat([...t])}}s=n}return s}tryToHighlightSupportScoreInHighlightsPanel=t=>{this.supportScoreHighlight($(t.parentNode.parentNode),this.querySelectorDeep("slot",t.parentNode.parentNode)?.[0]?.innerText)};supportScoreHighlight=(t,e)=>{let n=isNaN(parseFloat(e))?0:parseFloat(e);n>GLOBAL.settingsManager.settings.ssRedThreshold?t.css("background-color","#ea9999"):n>GLOBAL.settingsManager.settings.ssOrangeThreshold?t.css("background-color","#f5b799"):n>GLOBAL.settingsManager.settings.ssYellowThreshold?t.css("background-color","#ffe599"):t.css("background-color","#d9ead3")};findEscalatedToT3OrDevWarning=t=>{if("WARNING!!! This case has already been escalated to Tier 3 or Dev. Do not click save!"==t.textContent){$(t.parentNode).closest("div.uiTabset--base").find('span.title:contains("T3")').closest("li").hide(),$('span.title:contains("Post")').click()}};findFilesSection=t=>{if("Files"==t.textContent){$(t.parentNode).closest(".forceListViewManager").length>0&&this.waitForFileLinks()}};waitForFileLinks=()=>{setTimeout((()=>{let t=$('button[title="Close Files"]');console.log("close button",t),t.length>0&&(GLOBAL.fileTabCloseButton=t);let e=$("a:not('.tabHeader')[href*=\"/ContentDocument/\"] span.itemTitle.desktop");e.length>0?(GLOBAL.fileLinks=e,"function"==typeof GLOBAL.imageUrlResolvedCallback&&GLOBAL.imageUrlResolvedCallback(e)):this.waitForFileLinks()}),100)};allUrlHyperlinking=t=>{if(/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=t.textContent,n=/^https:\/\/clarizenint\.atlassian\.net\/browse\/CLZDEV-\d*/.test(e)?e.split("/").pop():e;$(t.parentNode).html(`<a href="${e}" target="_blank">${n}</a>`)}};changepointIdHyperlinking=t=>{if(/^CP(C|E)-20\d{2,2}-\d{5,5}$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=t.textContent,n=`https://desktop.changepointasp.com/core/portlet.aspx?ui=p&portletid=dcrequest&Params=action=edit;reqnum=${e}`;setTimeout((()=>{$(t.parentNode).html(`<a href="${n}" target="_blank">${e}</a>`)}),100)}};agilePlaceIdHyperlinking=t=>{if(/^planview\.leankit\.com\/card\/\d{10}$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=t.textContent.split("/").reverse()[0],n=`https://${t.textContent}`;setTimeout((()=>{$(t.parentNode).html(`<a href="${n}" target="_blank">${e}</a>`)}),100)}};tasktopZendeskIdHyperlinking=t=>{if(/^TT-\d\d*\d$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=`https://tasktopsupport.zendesk.com/agent/tickets/${t.textContent.split("-")[1]}`;setTimeout((()=>{$(t.parentNode).html(`<a href="${e}" target="_blank">${t.textContent}</a>`)}),100)}};tasktopJiraIdHyperlinking=t=>{if(/^(VIZ|APPS|CON|viz|con|apps)\-\d*$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=t.textContent,n=`https://tasktop${window.location.href.includes("planview.lightning")?"":"-sandbox"}.atlassian.net/browse/${e}`;setTimeout((()=>{$(t.parentNode).html(`<a href="${n}" target="_blank">${e}</a>`)}),100)}};tasktopJiraIdHyperlinkingManyIds=t=>{if(/^((VIZ|APPS|CON|viz|con|apps)\-\d*\,).*(VIZ|APPS|CON|viz|con|apps)\-\d*$/.test(t.textContent)&&!$(t.parentNode).is("a")){let e=t.textContent.replaceAll(" ","").replaceAll(",","%2c"),n=`https://tasktop${window.location.href.includes("planview.lightning")?"":"-sandbox"}.atlassian.net/browse/${t.textContent.split(",")[0]}?jql=key%20in%20(${e})`;setTimeout((()=>{$(t.parentNode).html(`<a href="${n}" target="_blank">${t.textContent}</a>`)}),100)}};supportScoreInReportsHighlighting1=t=>{if("Support Score"==t.textContent){let e=$(t.parentNode),n=e.closest("th"),i=e.closest("table");if(n.length>0){let t=n.index()+1,e=i.find(`td:nth-child(${t}) span.css-13whmom`);e.length,e.each(((t,e)=>{let n=(e=$(e)).closest("td");this.supportScoreHighlight(n,e.html())}))}}};supportScoreInReportsHighlighting2=t=>{if(/^\d*\.\d*$/.test(t.textContent)){let e=$(t.parentNode),n=this.supportScoreTd(e);n&&this.supportScoreHighlight(n,e.html())}};supportScoreTd=t=>{let e=t.closest("td"),n=e.attr("data-column-index"),i=t.closest("table").find('span[data-tooltip="Support Score"]').closest("th").attr("data-column-index");return!(!n||!i||n!=i)&&e};supportScoreInTableHighlighting=t=>{if(!isNaN(t.textContent)){let e=$(t.parentNode).closest("table");if(e.length>0){let t=$(e).find('th[title="Support Score"]');if(t.length>0){let n=t.index()+1;e.find(`td:nth-child(${n}) span.slds-truncate.uiOutputNumber`).each(((t,e)=>{e=$(e),this.supportScoreHighlight(e.parent().parent(),e.html())}))}}}};defectRequestIssueInTableHyperlinking=t=>{if(/^https:\/\//.test(t.textContent)){let e=$(t.parentNode).closest("table");if(e.length>0){let t=$(e).find('th[title="Defect Request Issue"]');if(t.length>0){let n=t.index()+1;e.find(`td:nth-child(${n}) span.slds-truncate.uiOutputText`).each(((t,e)=>{let n=$(e).html();if(/^https:\/\//.test(n)){let t=/^https:\/\/clarizenint\.atlassian\.net\/browse\/CLZDEV-\d*/.test(n)?n.split("/").pop():n;$(e).html(`<a href="${n}" target="_blank">${t}</a>`)}}))}}}};clickOnInternalOnly=t=>{"Internal Only"==t.textContent&&JSON.parse(GLOBAL.settingsManager.settings.autoClickInternalUpdatesTab)&&$(t.parentNode).click()};color=t=>{for(let e in this.textMatchStyles){let n=this.textMatchStyles[e];if(n.exactMatch&&n.text==t.textContent||!n.exactMatch&&t.textContent.includes(n.text))if(n.ancestorToHighlight&&Array.isArray(n.ancestorToHighlight)){let e=!1;for(let i in n.ancestorToHighlight){let s=n.ancestorToHighlight[i],o=$(t.parentNode).closest(s);if(o.length>0){e=!0,this.styleThis(o,n);break}}!e&&n.highlightIfAncestorNotFound&&this.styleThis($(t.parentNode),n)}else this.styleThis($(t.parentNode),n)}};styleThis=(t,e)=>{t.css("background-color",e.bgColor),t.css("color",e.textColor)};gatherCaseIdNumberPairs=t=>{if(/^\d{8}$/.test(t.textContent)&&$(t.parentNode).hasClass("uiOutputText")&&$(t.parentNode.parentNode).hasClass("test-splitViewCardData")){let e=$(t.parentNode).closest("a").attr("data-recordid");GLOBAL.caseIdNumberPairs[t.textContent]={caseNumber:t.textContent,caseId:e,textNode:t,highlighted:!1},GLOBAL.caseIdNumberPairs[e]={caseNumber:t.textContent,caseId:e,textNode:t,highlighted:!1},this.monitorActiveCasesAsTheyAppear()}};monitorActiveCasesAsTheyAppear=()=>{GLOBAL.activeCaseId=GLOBAL.pathname.split("/")[GLOBAL.pathname.split("/").length-2],Object.keys(GLOBAL.caseIdNumberPairs).includes(GLOBAL.activeCaseId)&&(GLOBAL.activeCaseNumber=GLOBAL.caseIdNumberPairs[GLOBAL.activeCaseId].caseNumber,this.highlightActiveCase())};defectRequestMod=t=>{const e="Defect Request Issue",n=`span:contains('${e}')`,i=$(t).find(n).filter((function(){return $(this).text()==e}));if(i.length>0){const t=i.parent().siblings().find("span span");if(t.length>0){let e=t.html();if(/^http.*\:\/\/.*\./.test(e)&&!e.includes(" ")){let n=/^https:\/\/clarizenint\.atlassian\.net\/browse\/CLZDEV-\d*/.test(e)?e.split("/").pop():e;t.html(`<a href='${e}' target='_blank'>${n}</a>`)}}}};accessLinkMod=t=>{const e="Access Link",n=`span:contains('${e}')`,i=$(t).find(n).filter((function(){return $(this).text()==e}));if(i.length>0){const e=i.parent().siblings().find("span.uiOutputTextArea"),n="string"!=typeof e.html()||""==e.html().replace(/<a.*<\/a>/g,"").replace(/<\!--.*-->/g,""),s=i.parent().siblings().find("a");if(n&&1==s.length){const e=s.attr("href"),n=this.accessLinkExpiration(e);let i=n.label,o=n.color;/^((https|http|HTTPS|HTTP):\/\/.*(EXP|exp).*(CSIG|csig)[-A-Za-z0-9+&@#\/%?=~_|!:,.;]+[-A-Za-z0-9+&@#\/%=~_|])$/g.test(e)?/^((https|http|HTTPS|HTTP):\/\/.*(EXP|exp).*(CSIG|csig)[-A-Za-z0-9+&@#\/%?=~_|!:,.;]+[-A-Za-z0-9+&@#\/%=~_|])$/g.test(e)&&(o="green"):(i="Invalid access link",o="red"),s.html(i),s.css("color",o),n.expired||this.keepALupdated(t)}else(!n||s.length>1)&&(e.html("Invalid access link"),e.css("color","red"))}};accessLinkExpiration=t=>{let e="exp%3D",n=t.search(e);-1==n&&(e="exp=",n=t.search(e));const i=Number(t.substring(n+e.length,n+e.length+14)),s=new Date(new Date(i).setFullYear(new Date(i).getFullYear()-1969)),o=new Date;let a,r="red",l=!1;if(s>o){let t=Math.abs(s-o)/1e3;const e=Math.floor(t/86400);t-=86400*e;const n=Math.floor(t/3600)%24;t-=3600*n;t-=60*(Math.floor(t/60)%60);Math.floor(t);a=`Access link (expires in ${e} days ${n} hours)`,e>5?r="green":e>=1&&(r="orange")}else a=`Access link expired on ${s}`,l=!0;return{label:a,color:r,expired:l}};keepALupdated=t=>{setTimeout((()=>{this.accessLinkMod(t)}),36e5)}}const asyncRequest=(t,e,n,i)=>(n=JSON.stringify(n),new Promise(((s,o)=>{GM_xmlhttpRequest({method:t,url:e,data:n,headers:i,onload:function(t){s(JSON.parse(t.response))},onerror:function(t){o(t)}})}))),removeCookies=async()=>{await asyncRequest("GET","https://servicecloudpremium-781150c5a240.herokuapp.com/removeCookies",{}),console.log("cookies cleared.")};class ChatSummary{constructor(t,e){this.cooldown=5e3,this.parentSelector=t,this.caseId=e,this.loader=null,this.userKey=null,this.user="Roland Pumputis",this.init(),this.editors={},this.environment="prd",this.atMentionableUsers=null,this.instanceId=this.generateUUID(),this.tokenSeparator=this.generateUUID(),this.tagRandomizer=this.generateUUID()}generateUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}));showLoader=()=>{this.loader&&this.loader.showing||(this.loader=new LoadingIndicator(this.parentSelector),this.loader.show())};hideLoader=()=>{null==this.loader?console.log("loader missing, something is wrong."):this.loader.hide()};init=()=>{this.showLoader(),setTimeout((()=>{const t={method:"GET",url:`https://servicecloudpremium-781150c5a240.herokuapp.com/getFeedOfCase?caseId=${this.caseId}`,data:JSON.stringify({}),onload:this.handleGetFeedOfCaseResponse};GM_xmlhttpRequest(t)}),0)};handleGetFeedOfCaseResponse=t=>{200==t.status?(t={body:JSON.parse(t.response),timestamp:Date.now()},this.updateUI(t.body.next,t.body.data)):(this.hideLoader(),console.log("failed feedResponse:",t),$(this.parentSelector).html("Failed to get comments... API error detected. Please get in touch with rpumputis@planview.com for support."),console.log("API error detected. Please get in touch with rpumputis@planview.com for support."))};_arrayBufferToBase64(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,s=0;s<i;s++)e+=String.fromCharCode(n[s]);return window.btoa(e)}updateUI=async(t,e)=>{if("authenticationFlow"==t)$(this.parentSelector).html(this.authenticateButton()),this.hideLoader(),$(document).off("click",`#roland-ui-mods-authenticate-button-${this.userKey}`).on("click",`#roland-ui-mods-authenticate-button-${this.userKey}`,(async()=>{this.showLoader();let t=await this.waitForCookie(5e3,20,0);console.log("cookie or no cookie:",t),t.success?this.init():(this.hideLoader(),$(this.parentSelector).html("Authentication failed... Please refresh your browser window and try again."))}));else{let t=this.atMentionableUsers;$(this.parentSelector).html(this.chatSummaryHTML(e));let n=`new-post--${this.instanceId}`;const i=this,s={allowedChars:/^[A-Za-z\sÅÄÖåäö]*$/,mentionDenotationChars:["@"],source:async function(e,n,s){if(null==t&&(t=(await i.asyncRequest("GET","https://servicecloudpremium-781150c5a240.herokuapp.com/getUsers")).data),0===e.length)n([{value:"Type to search",id:"",disabled:!0}],e);else{const i=[],s=[];for(let n=0;n<t.length;n++)t[n].value.toLowerCase().startsWith(e.toLowerCase())&&(s.push(t[n].id),i.push(t[n]));for(let n=0;n<t.length;n++)~t[n].value.toLowerCase().indexOf(e.toLowerCase())&&!s.includes(t[n].id)&&i.push(t[n]);n(i.slice(0,5),e)}}};this.quillEditorReferences=[],this.quillEditorReferences.push($(`#editor-${n}`)),this.editors[n]=new Quill(`#editor-${n}`,{modules:{toolbar:`#toolbar-${n}`,mention:s},placeholder:"Type your post here...",theme:"snow"}),this.editors[n].parentPost=null;for(let t in e)n=`new-comment-for-${e[t].id}--${this.instanceId}`,this.quillEditorReferences.push($(`#editor-${n}`)),this.editors[n]=new Quill(`#editor-${n}`,{modules:{toolbar:`#toolbar-${n}`,mention:s},placeholder:"Type your comment here...",theme:"snow"}),this.editors[n].parentPost=e[t].id;this.uiEvents(),this.hideLoader()}};asyncRequest=(t,e,n,i)=>(n=JSON.stringify(n),new Promise(((s,o)=>{GM_xmlhttpRequest({method:t,url:e,data:n,headers:i,onload:function(t){s(JSON.parse(t.response))},onerror:function(t){o(t)}})})));asyncRequestBlob=(t,e)=>new Promise(((n,i)=>{GM_xmlhttpRequest({url:e,method:t,responseType:"blob",onload:t=>{var e=new FileReader;e.onload=()=>{n(e.result)},e.readAsArrayBuffer(t.response)},onerror:t=>{console.log("Error:",t)}})}));waitForCookie=async(t,e,n)=>new Promise((async i=>{console.log("current attempt:",n),n<e?setTimeout((async()=>{const s=await this.asyncRequest("GET",`https://servicecloudpremium-781150c5a240.herokuapp.com/getcookie?userKey=${this.userKey}&user=${this.user}`,{});console.log(s),s.authenticated?i({success:!0,message:"Got a cookie!"}):i(this.waitForCookie(t,e,n+1))}),t):i({success:!1,message:"no cookie :("})}));authenticateButton=()=>{let t="planview--bizappspro.sandbox";"prd"==this.environment&&(t="planview");this.user=GLOBAL.settingsManager.settings.userName,this.userKey=this.createKey(64),this.caseId=GLOBAL.activeCaseId;const e=`${this.user};${this.caseId};${this.userKey}`,n=`https://${t}.my.salesforce.com/services/oauth2/authorize?client_id=${"prd"==this.environment?GLOBAL.SFDCappClientIdPrd:GLOBAL.SFDCappClientId}&redirect_uri=https://servicecloudpremium-781150c5a240.herokuapp.com/sfdcauth&response_type=code&state=${e}`;return`<div style="padding:15px;"><a class='big-blue-button' id='roland-ui-mods-authenticate-button-${this.userKey}' href="${n}" target="_blank">Authenticate</a></div>`};createKey=t=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i=0;for(;i<t;)e+=n.charAt(Math.floor(62*Math.random())),i+=1;return e};chatSummaryElementHTML=t=>`<div class='chat-summary-element${t.CreatedBy==this.user?" right":""}'>\n                    <div class='roland-ui-mods-timestamp'>${t.CreatedBy} on <span title='UTC: ${t.CreatedOn}'>${this.beautifyTime(2,t.CreatedOn)}</span></div>\n                    <div class="talk-bubble tri-right round right-in">\n                        <div class="talktext">\n                            <p>${t.Body}</p>\n                        </div>\n                    </div>\n                </div>`;chatSummaryHTML=t=>`<div id="roland-ui-mods-chat-summary-container">\n                    ${this.inputHTML(`new-post--${this.instanceId}`)}\n                    ${t.map((t=>this.postGroupHTML(t))).join("")}\n                </div>`;postGroupHTML=t=>`<div class="roland-ui-mods-post-group">\n                    ${this.postHTML(t)}\n                    ${this.commentsHTML(t.comments)}\n                    ${this.inputHTML(`new-comment-for-${t.id}--${this.instanceId}`)}\n                </div>`;postHTML=t=>this.commentHTML(t);commentsHTML=t=>`<div class="roland-ui-mods-comments-list">\n                    ${t.map((t=>this.commentHTML(t))).join("")}\n                </div>`;commentHTML=t=>{const e=t.createdBy==this.user;return`<div class='chat-summary-element${e?" right":""}'>\n                    <div class='roland-ui-mods-timestamp'>${t.createdBy} on <span title='UTC: ${t.createdOn}'>${this.beautifyTime(2,t.createdOn)}</span></div>\n                    <div class="talk-bubble tri-right round right-in${e?" current-user-comment":""}">\n                        <div class="talktext">\n                            <p>${this.prepMessageBodyForDisplay(t.body)}</p>\n                        </div>\n                    </div>\n                </div>`};prepMessageBodyForDisplay=t=>(t=this.handleSFDCimages(t),t=this.hyperlinkUrlsInMessageBody(t));hyperlinkUrlsInMessageBody=t=>{const e=/(?<=\s)http.*?\:\/\/.*?\..*?(?=(\s|$))/g;let n;for(;null!=(n=e.exec(t));){let e=n[0].split("<")[0];t=t.replace(n[0],`<a target="_blank" href="${e}">${e}</a>`)}return t};handleSFDCimages=t=>{const e=/<img src="sfdc:\/\/.*?>/g,n="roland-component-image-loading-indicator";let i;const s=[];for(;null!=(i=e.exec(t));){let e=i[0].split('"')[1].split("//")[1];s.push(e),t=t.replace(i[0],this.imageLoaderIndicator(n,e))}return this.loadSFDCimages(s,n),t};loadSFDCimages=async(t,e)=>{for(let n in t){let i=t[n];this.loadSingleImage(e,i)}};loadSingleImage=async(t,e)=>{const n=(await this.asyncRequest("GET",`https://servicecloudpremium-781150c5a240.herokuapp.com/getImageById?imageId=${e}`))?.data?.id,i=await this.asyncRequestBlob("GET",`https://planview.file.force.com/sfc/servlet.shepherd/version/download/${n}`);$(`div#${t}-${e}`).replaceWith(`<img class="roland-component-expandable-image" id="${t}-${n}" src="data:image/jpg;base64,${this._arrayBufferToBase64(i)}">`)};imageLoaderIndicator=(t,e)=>`<div id="${t}-${e}" class="${t}" title="Loading an image..."></div>`;inputHTMLfullOptions=t=>`<div class="roland-ui-mods-feed-item-input"><div class="roland-ui-mods-toolbar-editor-wrapper" id="roland-ui-mods-toolbar-editor-wrapper-${t}" id-suffix="${t}">\n        <div id="toolbar-${t}" id-suffix=${t}>\n              <span class="ql-formats">\n                <select class="ql-header">\n                  <option value="1">Heading</option>\n                  <option value="2">Subheading</option>\n                  <option selected>Normal</option>\n                </select>\n                <select class="ql-font">\n                  <option selected>Sans Serif</option>\n                  <option value="serif">Serif</option>\n                  <option value="monospace">Monospace</option>\n                </select>\n              </span>\n              <span class="ql-formats">\n                <button class="ql-bold"></button>\n                <button class="ql-italic"></button>\n                <button class="ql-underline"></button>\n                <button class="ql-strike"></button>\n              </span>\n              <span class="ql-formats">\n                <select class="ql-color"></select>\n                <select class="ql-background"></select>\n              </span>\n              <span class="ql-formats">\n                <button class="ql-list" value="ordered"></button>\n                <button class="ql-list" value="bullet"></button>\n                <select class="ql-align">\n                  <option selected></option>\n                  <option value="center"></option>\n                  <option value="right"></option>\n                  <option value="justify"></option>\n                </select>\n              </span>\n              <span class="ql-formats">\n                <button class="ql-blockquote"></button>\n                <button class="ql-link"></button>\n                <button class="ql-image"></button>\n                <button class="ql-code-block"></button>\n                <button class="ql-video"></button>\n              </span>\n              <span class="ql-formats">\n                <button class="ql-clean"></button>\n              </span>\n        </div>\n        <div id="editor-${t}" id-suffix=${t}>\n\n        </div>\n        <div id="roland-ui-mods-at-mention-menu-${t}" class="menu" role="listbox"></div>\n        <div id="roland-ui-mods-feed-item-send-${t}" id-suffix=${t} class="roland-ui-mods-send-button roland-ui-mods-send-post-button-style">Send</div>\n        </div>\n        <div id="roland-ui-mods-feed-item-post-${t}" id-suffix=${t} class="roland-ui-mods-post-button roland-ui-mods-send-post-button-style">Post</div>\n        </div>`;inputHTML=t=>`<div class="roland-ui-mods-feed-item-input"><div class="roland-ui-mods-toolbar-editor-wrapper" id="roland-ui-mods-toolbar-editor-wrapper-${t}" id-suffix="${t}">\n        <div id="toolbar-${t}" id-suffix=${t}>\n              <span class="ql-formats">\n                <button class="ql-bold"></button>\n                <button class="ql-italic"></button>\n                <button class="ql-underline"></button>\n                <button class="ql-strike"></button>\n              </span>\n              <span class="ql-formats">\n                <button class="ql-list" value="ordered"></button>\n                <button class="ql-list" value="bullet"></button>\n              </span>\n        </div>\n        <div id="editor-${t}" id-suffix=${t}>\n        </div>\n        <div id="roland-ui-mods-at-mention-menu-${t}" class="menu" role="listbox"></div>\n        <div id="roland-ui-mods-feed-item-send-${t}" id-suffix=${t} class="roland-ui-mods-send-button roland-ui-mods-send-post-button-style">Send</div>\n        </div>\n        <div id="roland-ui-mods-feed-item-post-${t}" id-suffix=${t} class="roland-ui-mods-post-button roland-ui-mods-send-post-button-style">Post</div>\n        </div>`;beautifyTime=(t,e)=>{e=new Date(e);const n=new Date,i=Math.abs(n-e);e.setTime(e.getTime()+60*t*60*1e3);return Math.ceil(i/864e5)>6?`${e.getFullYear()} ${e.toLocaleString("default",{month:"long"})} ${e.getDate()}, ${this.prefixZeroes(e.getUTCHours())}:${this.prefixZeroes(e.getMinutes())}`:`${this.weekdayNumberToName(e.getDay())}, ${this.prefixZeroes(e.getUTCHours())}:${this.prefixZeroes(e.getMinutes())}`};weekdayNumberToName=t=>({0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[t]);uiEvents=()=>{$(document).off("click",".roland-ui-mods-send-button").on("click",".roland-ui-mods-send-button",(t=>{const e=$(t.target).attr("id-suffix"),n={};$(this.editors[e].root).find("span.mention").each(((t,e)=>{console.log(e);let i=$(e).attr("data-id"),s=$(e).attr("data-value");n[i]=s})),console.log(n),this.createPostOrComment(this.editors[e].root.innerHTML,e,n)})),$(document).off("click",".roland-ui-mods-post-button").on("click",".roland-ui-mods-post-button",(t=>{const e=$(t.target).attr("id-suffix");$(".roland-ui-mods-toolbar-editor-wrapper").hide(),$(".roland-ui-mods-post-button").show(),$(`#roland-ui-mods-toolbar-editor-wrapper-${e}`).show(),$(t.target).hide()})),$(document).off("click",".roland-component-expandable-image").on("click",".roland-component-expandable-image",(t=>{this.expandableImageClicked(t)}))};expandableImageClicked=async t=>{let e={title:"Expanded image",content:`<div style="padding: 15px;">${$(`#${t.target.id}`).clone().prop("id",t.target.id+"-cloned").prop("outerHTML")}</div>`,buttons:{Close:{handler:null}},keyEvents:{13:{handler:null},27:{handler:null}},dim:!0,expandStepDuration:500,collapseStepDuration:300,expandCallback:null,collapseCallback:null},n=new Popup(e);n.keyEvents[13].handler=n.collapse,n.keyEvents[27].handler=n.collapse,n.buttons.Close.handler=n.collapse,$("body").append('<div id="roland-ui-mods-expandable-image-popup" style="padding:5px;position:fixed;width:96%;height:96%;top:2%;left:2%;z-index:9000;"></div>'),n.render("roland-ui-mods-expandable-image-popup"),n.expand(t)};createPost=async t=>{this.showLoader();const e=await this.asyncRequest("POST","https://servicecloudpremium-781150c5a240.herokuapp.com/createFeedItem",{body:{messageSegments:t},subjectId:this.caseId,feedElementType:"FeedItem"});this.init(),console.log("Post creation response:",e)};createComment=async(t,e)=>{this.showLoader();const n=await this.asyncRequest("POST",`https://servicecloudpremium-781150c5a240.herokuapp.com/createFeedComment?feedItemId=${t}`,{body:{messageSegments:e}});this.init(),console.log("Comment creation response:",n)};createPostOrComment=async(t,e,n)=>{const i=this.processAtMentions(t,n);console.log(i);const s=this.htmlToMessageSegments(i);console.log("Segments:",s),e==`new-post--${this.instanceId}`?this.createPost(s):this.createComment(e.split("-")[3],s)};htmlToMessageSegments=t=>{console.log(t);let e,n=/<.*?>/g,i=/<a .*?<\/a>/g,s=t.cleanHtml;for(;null!=(e=i.exec(s));)console.log(s),s=s.replace(e[0],this.htmlTagToMessageSegmentName(e[0]));for(;null!=(e=n.exec(s));)s=s.replace(e[0],this.htmlTagToMessageSegmentName(e[0]));console.log(s);let o=s.split(this.tokenSeparator),a=[];for(let t in o)o[t].length>0&&a.push(o[t]);console.log(a);const r=[];for(let t in a){let e=a[t];r.push(this.tokenToMessageSegments(e)),this.addZeroLengthSpaceAfterMention(r,e)}return console.log(r),r};addZeroLengthSpaceAfterMention=(t,e)=>{const n=e.split("--");if(n.length>1){"mention"==n[1].toLowerCase()&&(console.log("zero length space added: ",t),t.push({text:"​",type:"Text"}))}};tokenToMessageSegments=t=>t.startsWith(`TAG${this.tagRandomizer}--`)?this.tagTokenToMessageSegment(t):{text:t,type:"Text"};tagTokenToMessageSegment=t=>{const e=t.split("--"),n=e[1],i=e[2];if(console.log(t),"link"==n.toLowerCase()){return{type:"Link",url:e[3]}}if("mention"==n.toLowerCase()){return{type:"Mention",id:e[3]}}return{markupType:n,type:i}};htmlTagToMessageSegmentName=t=>{if(t.toLowerCase().startsWith("<p"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Paragraph--MarkupBegin${this.tokenSeparator}`;if(t.toLowerCase().startsWith("</p>"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Paragraph--MarkupEnd${this.tokenSeparator}`;if(t.toLowerCase().startsWith("<br>"))return" ";if(t.toLowerCase().startsWith("<strong"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Bold--MarkupBegin${this.tokenSeparator}`;if(t.toLowerCase().startsWith("</strong>"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Bold--MarkupEnd${this.tokenSeparator}`;if(t.toLowerCase().startsWith("<code"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Code--MarkupBegin${this.tokenSeparator}`;if(t.toLowerCase().startsWith("</code>"))return`${this.tokenSeparator}TAG${this.tagRandomizer}--Code--MarkupEnd${this.tokenSeparator}`;if(t.toLowerCase().startsWith("<a mention")&&t.toLowerCase().endsWith("</a>")){let e=t.split('"')[3];return`${this.tokenSeparator}TAG${this.tagRandomizer}--Mention--Mention--${e}${this.tokenSeparator}`}if(t.toLowerCase().startsWith("<a ")&&t.toLowerCase().endsWith("</a>")){let e=t.split('"')[1];return`${this.tokenSeparator}TAG${this.tagRandomizer}--Link--Link--${e}${this.tokenSeparator}`}return t.toLowerCase().startsWith("<em")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Italic--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</em>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Italic--MarkupEnd${this.tokenSeparator}`:t.toLowerCase().startsWith("<li")?`${this.tokenSeparator}TAG${this.tagRandomizer}--ListItem--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</li>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--ListItem--MarkupEnd${this.tokenSeparator}`:t.toLowerCase().startsWith("<ol")?`${this.tokenSeparator}TAG${this.tagRandomizer}--OrderedList--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</ol>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--OrderedLink--MarkupEnd${this.tokenSeparator}`:t.toLowerCase().startsWith("<s>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Strikethrough--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</s>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Strikethrough--MarkupEnd${this.tokenSeparator}`:t.toLowerCase().startsWith("<u>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Underline--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</u>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--Underline--MarkupEnd${this.tokenSeparator}`:t.toLowerCase().startsWith("<ul")?`${this.tokenSeparator}TAG${this.tagRandomizer}--UnorderedList--MarkupBegin${this.tokenSeparator}`:t.toLowerCase().startsWith("</ul>")?`${this.tokenSeparator}TAG${this.tagRandomizer}--UnorderedList--MarkupEnd${this.tokenSeparator}`:t};processAtMentions=(t,e)=>{let n,i=/<span class="mention" data-index=".*?denotation-char="@" data-(id|value)=".*?" data-(id|value)=".*?">.*?<\/span>.*?<\/span>.*?<\/span>/g;const s=[];for(;null!=(n=i.exec(t));)s.push({raw:n[0]});console.log("@mentions raw",t,s);for(let t in s){let e=s[t],i=/data-id=".*?"/g;for(;null!=(n=i.exec(e.raw));){let t=n[0].split('"')[1];e.id=t}}let o=t;for(let t in s){let n=s[t];console.log(n),o=o.replace(n.raw,`<a mention href="" data-id="${n.id}" data-name="${e[n.id]}">@${e[n.id]}</a>`)}return{html:t,cleanHtml:o,mentionedUserData:e}};prefixZeroes=t=>`0${t}`.slice(-2)}class WhosLooking{constructor(){this.cooldown=1e3,this.caseIdSent=null,this.lastMouseActivitySent=null,this.lastKeyboardActivitySent=null,this.payload=null,this.callDetails=null}check=()=>{setTimeout((()=>{if(GLOBAL.settingsManager.settings.userName&&GLOBAL.activeCaseId&&GLOBAL.mouseMovedOn&&(GLOBAL.activeCaseId!=this.caseIdSent||GLOBAL.mouseMovedOn!=this.lastMouseActivitySent||GLOBAL.keyPressedOn!=this.lastKeyboardActivitySent)){let t=GLOBAL.keyPressedOn&&GLOBAL.keyPressedOn>GLOBAL.mouseMovedOn?GLOBAL.keyPressedOn:GLOBAL.mouseMovedOn;this.payload={caseId:GLOBAL.activeCaseId,name:GLOBAL.settingsManager.settings.userName,lastActivityTimestamp:t,lastKeypressTimestamp:GLOBAL.keyPressedOn,lastMouseMovement:GLOBAL.mouseMovedOn,backgroundColor:GLOBAL.settingsManager.settings.avatarColor,version:GLOBAL.version},this.callDetails={method:"POST",url:"http://servicecloudpremium-781150c5a240.herokuapp.com/whosLookingStatusUpdate",data:JSON.stringify(this.payload),onload:this.updateUI},GM_xmlhttpRequest(this.callDetails)}this.check()}),this.cooldown)};updateUI=t=>{200==t.status?(GLOBAL.whosLookingResponse={response:JSON.parse(t.response),timestamp:Date.now()},this.caseIdSent=this.payload.caseId,this.lastMouseActivitySent=this.payload.lastMouseMovement,this.lastKeyboardActivitySent=this.payload.lastKeypressTimestamp):console.log("API error detected. Please get in touch with rpumputis@planview.com for support.")}}class SettingsManager{constructor(){this.settingsList=null,this.settings=null,this.defaultSettings={textMatchStyles:JSON.stringify([{text:"New",exactMatch:!0,bgColor:"#FFB648",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Initial",exactMatch:!0,bgColor:"#FFB648",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Active",exactMatch:!0,bgColor:"#E34F32",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Needs Reply",exactMatch:!0,bgColor:"#E34F32",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Pending Internal Team Response",exactMatch:!0,bgColor:"#E34F32",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Pending Customer",exactMatch:!0,bgColor:"#3091EC",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"In Development",exactMatch:!0,bgColor:"#949494",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Pending Release",exactMatch:!0,bgColor:"#2F3941",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Solution Provided",exactMatch:!0,bgColor:"#2F3941",textColor:"#D8DCDE",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"1 - Flagged to Case Owner",exactMatch:!0,bgColor:"#d9ead3",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"1 - Watching",exactMatch:!0,bgColor:"#d9ead3",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"2 - Elevated to Manager",exactMatch:!0,bgColor:"#ffe599",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"3 - Escalated to Development",exactMatch:!0,bgColor:"#f5b799",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"3 - Escalated to PM/Infrastructure team",exactMatch:!0,bgColor:"#f5b799",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"4 - Global XCAR",exactMatch:!0,bgColor:"#ea9999",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"To: Internal",exactMatch:!0,bgColor:"#FFF6D9",textColor:"",ancestorToHighlight:[".cuf-element"],highlightIfAncestorNotFound:!1},{text:"Case status updated",exactMatch:!0,bgColor:"#FFF6D9",textColor:"",ancestorToHighlight:[".cuf-element"],highlightIfAncestorNotFound:!1},{text:"Case updated",exactMatch:!0,bgColor:"#FFF6D9",textColor:"",ancestorToHighlight:[".cuf-element"],highlightIfAncestorNotFound:!1},{text:"Case created",exactMatch:!0,bgColor:"#FFF6D9",textColor:"",ancestorToHighlight:[".cuf-element"],highlightIfAncestorNotFound:!1},{text:"...",exactMatch:!0,bgColor:"#FFF6D9",textColor:"",ancestorToHighlight:[".cuf-element"],highlightIfAncestorNotFound:!1},{text:"Elite",exactMatch:!1,bgColor:"#ffcb2a",textColor:"",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!1},{text:"Premium",exactMatch:!1,bgColor:"#bababa",textColor:"",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!1},{text:"GREEN",exactMatch:!0,bgColor:"#d9ead3",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"AMBER",exactMatch:!0,bgColor:"#f5b799",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"RED",exactMatch:!0,bgColor:"#ea9999",textColor:"#000000",ancestorToHighlight:[".slds-form-element"],highlightIfAncestorNotFound:!0},{text:"Scheduled Task",exactMatch:!0,bgColor:"#3ba755",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0},{text:"Ongoing Activity",exactMatch:!0,bgColor:"#3ba755",textColor:"#ffffff",ancestorToHighlight:[],highlightIfAncestorNotFound:!0}]),avatarColor:"#E34F32",autoClickInternalUpdatesTab:JSON.stringify(!1),userName:null,scrollbarWidth:3,listRefreshRate:60,reportRefreshRate:0,disableListRefresh:!1,closeAllTabsUsingCtrlQ:!1,openAllImagesUsingCtrlI:!1,allUrlHyperlinkingBeta:!1,ssRedThreshold:90,ssOrangeThreshold:80,ssYellowThreshold:70,overrideStandardFeedFont:!1,customFeedFont:"",feedFontFamily:"Sans-Serif",feedFontSize:"12",hideEmptyMilestones:!0,enableChatModule:!1,defaultToChatModule:!1},this.run()}getSettingsList=()=>(this.settingsList=GM_listValues(),this.settingsList);getSettings=()=>{let t={};for(let e in this.settingsList){let n=this.settingsList[e];t[n]=GM_getValue(n)}return this.settings=t,this.settings};update=(t,e)=>(GM_setValue(t,e),this.settingsList.push(t),this.settings[t]=e,this.settings);applyDefaultSettings=()=>{"v20230623"==GLOBAL.version&&"v20230623"!=this.settings.clearedTextMatchStylesInVersion&&(this.update("clearedTextMatchStylesInVersion","v20230623"),this.update("textMatchStyles",JSON.stringify(JSON.parse(this.defaultSettings.textMatchStyles),void 0,4)),this.getSettingsList(),this.getSettings(),console.log(this.settings));for(let t in this.defaultSettings)Object.keys(this.settings).includes(t)||(this.settings[t]=this.defaultSettings[t]);return this.settings};run=()=>{this.getSettingsList(),this.getSettings(),this.applyDefaultSettings()}}class CommentInputClass{constructor(t,e,n,i,s){this.label=n,this.focusNext=i,this.focusPrevious=s,this.parentId=t,this.idSuffix=e,this.containerClass="comment-input-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.textAreaClass="comment-textarea",this.textAreaId=`${this.textAreaClass}-${this.idSuffix}`}clear=()=>{$(`#${this.textAreaId}`).val("")};focus=()=>{setTimeout((()=>{$(`#${this.textAreaId}`).focus()}),50)};render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};getValue=()=>$(`#${this.textAreaId}`).val();uiEvents=()=>{$(document).off("keydown",`#${this.textAreaId}`).on("keydown",`#${this.textAreaId}`,(t=>{13==t.keyCode?this.focusNext():27==t.keyCode&&this.focusPrevious()}))};fullHTML=()=>`<div class='${this.containerClass}'>\n                    <label for="${this.textAreaId}">${this.label}</label>\n                    <textarea placeholder="Type your comment here..." id="${this.textAreaId}" class="${this.textAreaClass}"></textarea>\n                </div>`}class DatepickerClass{constructor(t,e,n,i,s){this.label=n,this.focusNext=i,this.focusPrevious=s,this.parentId=t,this.currentDate=this.today(),this.idSuffix=e,this.containerClass="datepicker-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.datepickerClass="datepicker",this.datepickerId=`${this.datepickerClass}-${this.idSuffix}`,this.focusCooldown=!1}today=()=>{let t=new Date;return`${t.toLocaleString("default",{month:"long"})} ${t.getDate()}, ${t.getFullYear()}`};focus=()=>{setTimeout((()=>{$(`#${this.datepickerId}`).focus()}),50)};render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};getValue=()=>this.convertToSFDCdate($(`#${this.datepickerId}`).val());convertToSFDCdate=t=>{let e=null;const n={january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"};try{const i=t.split(" ")[2],s=n[t.split(" ")[0].toLowerCase()];e=`${i}-${s}-${`00${t.split(" ")[1].split(",")[0]}`.slice(-2)}`}catch(t){return console.log("Could not convert date to SFDC format."),null}return e};uiEvents=()=>{$(`#${this.datepickerId}`).datepicker({changeMonth:!0,changeYear:!0,yearRange:`${(new Date).getFullYear()-1}:${(new Date).getFullYear()+1}`,dateFormat:"MM d, yy",defaultDate:new Date,onSelect:t=>{$(`#${this.datepickerId}`).datepicker("hide"),this.focusCooldown||(this.focusCooldown=!0,this.focusNext(),setTimeout((()=>{this.focusCooldown=!1}),1e3))}}),$(document).off("keydown",`#${this.datepickerId}`).on("keydown",`#${this.datepickerId}`,(t=>{27==t.keyCode&&this.focusPrevious()}))};fullHTML=()=>`<div class='${this.containerClass}'>\n                    <label for="${this.datepickerId}">${this.label}:</label>\n                    <input type="text" id="${this.datepickerId}" value="${this.currentDate}"></input>\n                </div>`}class HoursInputClass{constructor(t,e,n,i,s){this.label=n,this.focusNext=i,this.focusPrevious=s,this.parentId=t,this.idSuffix=e,this.containerClass="hours-picker-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.hoursInputClass="hours-input",this.hoursInputId=`${this.hoursInputClass}-${this.idSuffix}`}clear=()=>{$(`#${this.hoursInputId}`).val("1")};focus=()=>{setTimeout((()=>{$(`#${this.hoursInputId}`).focus()}),50)};render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};getValue=()=>$(`#${this.hoursInputId}`).val();uiEvents=()=>{$(document).off("keydown",`#${this.hoursInputId}`).on("keydown",`#${this.hoursInputId}`,(t=>{13==t.keyCode?this.focusNext():27==t.keyCode&&this.focusPrevious()}))};fullHTML=()=>`<div class='${this.containerClass}'>\n                    <label for="${this.hoursInputId}">${this.label}:</label>\n                    <input type="number" id="${this.hoursInputId}" value="1" step='0.5' min="0.5" max='8'></input>\n                </div>`}class JobQueueClass{constructor(t,e){this.parentId=t,this.idSuffix=e,this.containerClass="job-queue-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.jobQueueClass="job-queue",this.jobQueueId=`${this.jobQueueClass}-${this.idSuffix}`,this.jobs=[],this.activityNameClass="job-activity-name"}uuid=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)));addJob=t=>{t.id=this.uuid(),t.parent=this.jobs,t.completed=!1,t.failed=!1,this.jobs.push(t),this.awaitJob(t),$(`#${this.containerId}`).append(this.jobTemplate(t))};job=(t,e,n,i)=>({info:t,promise:e,apiDetailsForRepetition:n,activityName:i});repeatJob=t=>{const e=t.apiDetailsForRepetition.method,n=t.apiDetailsForRepetition.endpoint,i=t.apiDetailsForRepetition.body,s=this.job(t.info,asyncRequest(e,n,i,{}),t.apiDetailsForRepetition,t.activityName);s.id=this.uuid(),s.parent=this.jobs,s.completed=!1,s.failed=!1,this.jobs.push(s),this.awaitJob(s),$(`#job-${t.id}`).fadeOut(500),$(`#${this.containerId}`).append(this.jobTemplate(s))};awaitJob=async t=>{const e=await t.promise;t.completed=!0;const n=!(!1===e.data.data?.response?.success);try{n||(t.errorMessage=JSON.parse(e.data.data.response.data.response.response)[0].message)}catch(t){console.log(t)}t.failed=!n,$(`#job-${t.id}`).replaceWith(this.jobTemplate(t)),t.failed||this.jobDone(t)};jobDone=t=>{let e=null;for(let n in this.jobs)this.jobs[n].id===t.id&&(e=n);$(`#job-${t.id}`).fadeOut(3e3,(function(){}))};render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};uiEvents=()=>{$(document).off("click",".roland-component-job-failure-indicator").on("click",".roland-component-job-failure-indicator",(t=>{const e=t.target.id.split("--")[1];for(let t in this.jobs)this.jobs[t].id===e&&this.repeatJob(this.jobs[t])}))};fullHTML=()=>`<div id="${this.containerId}" class='${this.containerClass}'>\n                    ${this.jobs.map((t=>this.jobTemplate(t))).join("")}\n                </div>`;jobTemplate=t=>`<div id="job-${t.id}">\n                    <div class='job-card-content'>\n                        <div class='job-card-content-element job-card-content-customer'>${t.activityName.split("[")[1].split("]")[0]}</div>\n                        <div class='job-card-content-element job-card-content-title'>${t.activityName.split("[")[0]}</div>\n                        <div class='job-card-content-element job-card-content-time-type'>${t.info.Hours__c} hour${1==t.info.Hours__c?"":"s"} of ${t.info.Case_Sub_type__c}</div>\n                    </div>  \n                    <div class='job-card-indicator'>\n                        <div ${t.failed?`title="${t.errorMessage}"`:""} id="job-indicator--${t.id}" class="${t.completed?t.failed?"roland-component-job-failure-indicator":"roland-component-job-success-indicator":"roland-component-job-loading-indicator"}"></div>\n                    </div>\n                </div>\n      `}class SearchablePicklistClass{constructor(t,e,n,i,s,o,a){this.data=i,this.maxResultsLength=5,this.parentId=t,this.label=n,this.placeholder=s,this.focusNext=o,this.focusPrevious=a,this.tamActivities=i,this.selectedId=null,this.selectedName=null,this.filteredTAMactivities=[],this.idSuffix=e,this.generalContainerClass="hours-logging-form-input",this.containerClass="searchable-picklist-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.containerInnerClass="searchable-picklist-container-inner",this.containerInnerId=`${this.containerInnerClass}-${this.idSuffix}`,this.inputClass="searchable-picklist-input",this.inputId=`${this.inputClass}-${this.idSuffix}`,this.resultsClass="searchable-picklist-results",this.resultsId=`${this.resultsClass}-${this.idSuffix}`,this.resultClass="searchable-picklist-result",this.resultId=`${this.resultClass}-${this.idSuffix}`,this.resultSelectedClass=`${this.resultClass}-selected`}render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};clear=()=>{this.selectedName="",this.selectedId="",$(`#${this.inputId}`).val("")};set=(t,e)=>{this.selectedName=t,this.selectedId=e,this.focusNext()};focus=()=>{setTimeout((()=>{$(`#${this.inputId}`).focus()}),50)};uiEvents=()=>{$(document).off("input",`#${this.inputId}`).on("input",`#${this.inputId}`,(t=>{this.filterActivities(t.target.value),this.updateResultsList()})),$(document).off("focusout",`#${this.inputId}`).on("focusout",`#${this.inputId}`,(t=>{setTimeout((()=>{this.filterActivities(""),this.updateResultsList()}),100)})),$(document).off("focus",`#${this.inputId}`).on("focus",`#${this.inputId}`,(t=>{this.filterActivities(t.target.value),this.updateResultsList()})),$(document).off("click",`.${this.resultId}`).on("click",`.${this.resultId}`,(t=>{const e=$("#"+t.target.id).html();this.set(e,this.getActivityIdByName(e)),this.mouseSelect(e),this.updateResultsList()})),$(document).off("keydown",`#${this.inputId}`).on("keydown",`#${this.inputId}`,(t=>{40==t.keyCode?(this.selectDown(),this.updateResultsList()):38==t.keyCode?(this.selectUp(),this.updateResultsList()):13==t.keyCode?(this.select(t.target),this.updateResultsList()):27==t.keyCode&&(this.filterActivities(""),this.updateResultsList(),this.focusPrevious())}))};getActivityIdByName=t=>{for(let e in this.tamActivities){let n=this.tamActivities[e];if(n.name.toLowerCase()==t.toLowerCase())return n.id}throw"no such activity..."};getValue=()=>$(`#${this.inputId}`).val();mouseSelect=t=>{$(`#${this.inputId}`).val(t),this.filteredTAMactivities=[]};select=t=>{if(this.filteredTAMactivities.length>0){const e=this.findSelectedActivityAndIndex().activity;t.value=e.name,this.set(e.name,e.id),this.filteredTAMactivities=[]}};selectUp=()=>{if(this.filteredTAMactivities.length>0){const t=this.findSelectedActivityAndIndex(),e=t.activity,n=t.index;e.selected=!1;try{this.filteredTAMactivities[n-1].selected=!0}catch{this.filteredTAMactivities[this.filteredTAMactivities.length-1].selected=!0}}};selectDown=()=>{if(this.filteredTAMactivities.length>0){const t=this.findSelectedActivityAndIndex(),e=t.activity,n=t.index;e.selected=!1;try{this.filteredTAMactivities[n+1].selected=!0}catch{this.filteredTAMactivities[0].selected=!0}}};findSelectedActivityAndIndex=()=>{for(let t in this.filteredTAMactivities){let e=this.filteredTAMactivities[t];if(e.selected)return{activity:e,index:parseInt(t)}}};updateResultsList=()=>{$(`#${this.resultsId}`).html(this.resultsHTML())};filterActivities=t=>{this.filteredTAMactivities=[];for(let e in this.tamActivities){let n=this.tamActivities[e].name;t.length>0&&n.toLowerCase().includes(t.toLowerCase())&&(this.tamActivities[e].selected=0==this.filteredTAMactivities.length,this.filteredTAMactivities.length<this.maxResultsLength&&this.filteredTAMactivities.push(this.tamActivities[e]))}};fullHTML=()=>`<div class='${this.containerClass} ${this.generalContainerClass}'>\n                    <label for="${this.inputId}">${this.label}:</label>\n                   <div class='${this.containerInnerClass}'>\n                        <input autocomplete="one-time-code" id="${this.inputId}" class="${this.inputClass}" type='text' placeholder="${this.placeholder}"></input>\n                        ${this.resultsHTML()}\n                    </div>\n                </div>`;resultsHTML=()=>`<div id="${this.resultsId}" class="${this.resultsClass}">\n                    ${this.filteredTAMactivities.map(((t,e)=>this.resultHTML(t,e))).join("")}\n                </div>`;resultHTML=(t,e)=>`<div id="${this.resultId}-${e}" class="${this.resultId} ${this.resultClass} ${t.selected?this.resultSelectedClass:""}">${t.name}</div>`}class SubmitButtonClass{constructor(t,e,n,i,s,o){this.submitDataAction=i,this.focusNext=s,this.focusPrevious=o,this.label=n,this.parentId=t,this.idSuffix=e,this.containerClass="submit-button-container",this.containerId=`${this.containerClass}-${this.idSuffix}`,this.submitButtonClass="submit-button",this.submitButtonId=`${this.submitButtonClass}-${this.idSuffix}`}focus=()=>{setTimeout((()=>{$(`#${this.submitButtonId}`).focus()}),50)};render=()=>{$(`#${this.parentId}`).append(this.fullHTML()),this.uiEvents()};uiEvents=()=>{$(document).off("click",`#${this.submitButtonId}`).on("click",`#${this.submitButtonId}`,(t=>{this.focusNext(),this.submitDataAction()})),$(document).off("keydown",`#${this.submitButtonId}`).on("keydown",`#${this.submitButtonId}`,(t=>{27==t.keyCode&&setTimeout((()=>{this.focusPrevious()}),100)}))};fullHTML=()=>`<div class='${this.containerClass}'>\n                    <label>${this.label}</label>\n                    <button id="${this.submitButtonId}" class="${this.submitButtonClass}">SUBMIT</input>\n                </div>`}class TimesheetInputFormClass{constructor(t,e,n){this.data=e,this.jobQueueWidget=n,this.parentId=t,this.containerClass="timesheet-input-form-container",this.containerId=`${this.containerClass}`,this.currentFocus="tamActivityList",this.nextFocus={tamActivityList:"typeList",typeList:"timesheetDatepicker",timesheetDatepicker:"timesheetHoursInput",timesheetHoursInput:"commentInput",commentInput:"submitButton",submitButton:"tamActivityList"},this.previousFocus={tamActivityList:"submitButton",typeList:"tamActivityList",timesheetDatepicker:"typeList",timesheetHoursInput:"timesheetDatepicker",commentInput:"timesheetHoursInput",submitButton:"commentInput"},this.children={tamActivityList:new SearchablePicklistClass(this.containerId,"tam-acivity-list","TAM Activity",this.data.activities,"TAM activity name goes here...",this.focusNext,this.focusPrevious),typeList:new SearchablePicklistClass(this.containerId,"type-list","Type",this.data.types,"Type goes here...",this.focusNext,this.focusPrevious),timesheetDatepicker:new DatepickerClass(this.containerId,"timesheet-datepicker","Date",this.focusNext,this.focusPrevious),timesheetHoursInput:new HoursInputClass(this.containerId,"timesheet-hours-input","Hours",this.focusNext,this.focusPrevious),commentInput:new CommentInputClass(this.containerId,"comment-input","",this.focusNext,this.focusPrevious),submitButton:new SubmitButtonClass(this.containerId,"submit-button","",this.submitDataAction,this.focusNext,this.focusPrevious)}}focusPrevious=()=>{this.currentFocus=this.previousFocus[this.currentFocus],this.children[this.currentFocus].focus()};focusNext=()=>{this.currentFocus=this.nextFocus[this.currentFocus],this.children[this.currentFocus].focus()};submitDataAction=async()=>{const t={RecordTypeId:"0128Y000001ImYUQA0",Type:"TAM Hours",Internal_Only__c:!0,ParentId:this.children.tamActivityList.selectedId,Case_Sub_type__c:this.children.typeList.getValue(),Reported_Date__c:this.children.timesheetDatepicker.getValue(),Hours__c:this.children.timesheetHoursInput.getValue(),Description:this.children.commentInput.getValue(),Hidden_Case_Account__c:this.resolveCustomerIdBasedOnActivity(this.children.tamActivityList.selectedName),Status:"Solution Provided",OwnerId:this.data.additionalData[0].userId};this.inputIsValid(t)?this.jobQueueWidget.addJob(this.job(t,asyncRequest("POST","https://servicecloudpremium-781150c5a240.herokuapp.com/createTAMhours",t,{}),{method:"POST",endpoint:"/createTAMhours",body:t},this.children.tamActivityList.selectedName)):alert("Insufficient data in the form..."),this.clearForm()};fauxPromise=()=>new Promise((t=>{setTimeout((()=>{t({success:!1,next:"showData",data:{}})}),5e3)}));job=(t,e,n,i)=>({info:t,promise:e,apiDetailsForRepetition:n,activityName:i});clearForm=()=>{this.children.tamActivityList.clear(),this.children.typeList.clear(),this.children.timesheetHoursInput.clear(),this.children.commentInput.clear()};inputIsValid=t=>{let e=!0;return t.ParentId||(e=!1),t.Case_Sub_type__c||(e=!1),t.Reported_Date__c||(e=!1),t.Hours__c||(e=!1),t.Hidden_Case_Account__c||(e=!1),t.OwnerId||(e=!1),e};resolveCustomerIdBasedOnActivity=t=>{for(let e in this.data.additionalData){let n=this.data.additionalData[e];if(t&&t.toLowerCase().includes(n.customerName.toLowerCase()))return n.customerId}return null};render=()=>{$(`#${this.parentId}`).append(this.fullHTML());for(let t in this.children)this.children[t].render();this.jobQueueWidget.render(),this.uiEvents()};uiEvents=()=>{this.children.tamActivityList.focus()};fullHTML=()=>`<div id="${this.containerId}" class='${this.containerClass}'>\n                    \n                </div>`}class UIinjector{constructor(){this.userName=null,this.addStyles(),this.uiEvents(),this.whosLookingText=null,this.whosLookingResponseTimestamp=null,this.chatLoader=null,this.environment="prd"}addStyles=()=>{GM_addStyle(GM_getResourceText("popupStyleCSS")),GM_addStyle(GM_getResourceText("quillJsCSS")),GM_addStyle(GM_getResourceText("quillMentionCSS")),GM_addStyle(GM_getResourceText("jQueryUIcss")),GM_addStyle(`\n            ::-webkit-scrollbar {\n                width: ${GLOBAL.settingsManager.settings.scrollbarWidth}px;\n                height: ${GLOBAL.settingsManager.settings.scrollbarWidth}px;\n            }\n            .big-blue-button {\n            background-color: rgb(1, 118, 211);\n            text-decoration: none;\n            color: white;\n            padding: 10px;\n            font-size: large;\n            font-weight: bolder;\n            border-radius: 0.25rem;\n            cursor: pointer;\n                display: inline-block;\n                margin-right: 10px;\n        }\n        #roland-ui-mods-header-buttons {\n            left: 100px;\n            position: absolute;            \n        }`),GM_addStyle(`.roland-ui-mods-whoslooking-indicator {\n            background-color: ${GLOBAL.settingsManager.settings.avatarColor};\n            color: white;\n            padding: 3px 7px 1px 7px;\n            font-size: medium;\n            font-weight: bolder;\n            border-radius: 0.25rem;\n            cursor: help;\n            margin-right: 3px;\n            display: inline-block;\n        }\n        .tiblock {\n            align-items: center;\n            display: flex;\n            height: 8px;\n        }\n        .ticontainer .tidot {\n            background-color: white;\n        }\n        .tidot {\n            -webkit-animation: mercuryTypingAnimation 1.5s infinite ease-in-out;\n            border-radius: 2px;\n            display: inline-block;\n            height: 4px;\n            margin: 2px;\n            width: 3px;\n        }\n        .roland-hide{\n            opacity: 0;\n        }\n        @-webkit-keyframes mercuryTypingAnimation{\n        0%{\n        -webkit-transform:translateY(0px)\n        }\n        28%{\n        -webkit-transform:translateY(-5px)\n        }\n        44%{\n        -webkit-transform:translateY(0px)\n        }\n        }\n        .tidot:nth-child(1){\n        -webkit-animation-delay:200ms;\n        }\n        .tidot:nth-child(2){\n        -webkit-animation-delay:300ms;\n        }\n        .tidot:nth-child(3){\n        -webkit-animation-delay:400ms;\n        }`),GM_addStyle(".big-blue-button:hover {\n            background-color: rgb(1, 68, 134);\n            color: white;\n            text-decoration: none;\n        }"),GM_addStyle(".big-blue-button:visited {\n            color: white;\n            text-decoration: none;\n        }"),GM_addStyle('\n        .roland-ui-mods-form-heading {\n            font-weight: bold;\n            font-style: italic;\n            border-bottom: 2px solid #ddd;\n            margin-bottom: 20px;\n            font-size: 15px;\n            padding-bottom: 3px;\n        }\n        .roland-ui-mods-form label{\n            display: block;\n            margin: 0px 0px 15px 0px;\n        }\n        .roland-ui-mods-form label > span{\n            width: 340px;\n            font-weight: bold;\n            float: left;\n            padding-top: 8px;\n            padding-right: 5px;\n        }\n        .roland-ui-mods-form input.roland-ui-mods-input-field,\n        .roland-ui-mods-form .roland-ui-mods-textarea-field {\n            box-sizing: border-box;\n            -webkit-box-sizing: border-box;\n            -moz-box-sizing: border-box;\n            border: 1px solid #C2C2C2;\n            box-shadow: 1px 1px 4px #EBEBEB;\n            -moz-box-shadow: 1px 1px 4px #EBEBEB;\n            -webkit-box-shadow: 1px 1px 4px #EBEBEB;\n            border-radius: 3px;\n            -webkit-border-radius: 3px;\n            -moz-border-radius: 3px;\n            padding: 7px;\n            outline: none;\n        }\n        .roland-ui-mods-form .roland-ui-mods-input-field:focus,\n        .roland-ui-mods-form .roland-ui-mods-textarea-field:focus {\n            border: 1px solid #0C0;\n        }\n        .roland-ui-mods-form .roland-ui-mods-textarea-field{\n            height:300px;\n            width: 100%;\n            margin-top: 10px;\n        }\n        .roland-ui-mods-form input[type="checkbox"] {margin-top: 10px;}'),GM_addStyle("\n        * {\n            box-sizing: border-box;\n        }\n        \n        .roland-ui-mods-feed-item-input {\n            width: 100%;\n            margin-left: auto;\n            margin-right: auto;\n        }\n        \n        .roland-ui-mods-send-post-button-style {\n            background-color: rgb(1, 118, 211);\n            text-decoration: none;\n            color: white;\n            padding: 5px;\n            font-size: large;\n            font-weight: bolder;\n            cursor: pointer;\n            display: inline-block;\n            margin-right: 10px;\n            width: 100%;\n            text-align: center;\n        }\n        \n        .roland-ui-mods-send-post-button-style:hover {\n            background-color: rgb(1, 68, 134);\n            color: white;\n            text-decoration: none;\n        }\n        \n        .quill-wrap .ql-active {\n            border: 1px solid #ccc !important;\n            border-radius: 4px;\n        }\n        \n        .quill-wrap button,\n        .quill-wrap .ql-picker {\n            margin-right: 2px\n        }\n        \n        .ql-container {\n            height: auto !important;\n        }\n        \n        .ql-editor {\n            height: auto !important;\n        }\n        \n        #roland-ui-mods-chat-summary-container {\n            background-color: white;\n            min-height: 100px;\n            padding: 10px;\n        }\n        \n        .roland-ui-mods-toolbar-editor-wrapper {\n            display: none;\n        }\n        \n        .talk-bubble {\n            margin: 10px;\n            margin-top: 5px;\n            margin-bottom: 20px;\n          display: inline-block;\n          position: relative;\n            max-width: 90%;\n            height: auto;\n            background-color: #ddd;\n        }\n        \n        .talk-bubble.current-user-comment {\n            background-color: rgba(232, 235, 250);\n        }\n        .round{\n          border-radius: 10px;\n            -webkit-border-radius: 10px;\n            -moz-border-radius: 10px;\n        }\n        .talktext{\n          padding: 1em;\n            text-align: left;\n        }\n        .talktext p{\n          /* remove webkit p margins */\n          -webkit-margin-before: 0em;\n          -webkit-margin-after: 0em;\n        }\n        .chat-summary-element {\n          width: 100%;\n        }\n        .right {\n          text-align: right;\n        }\n        .roland-ui-mods-timestamp {\n          color: #888;\n          padding-left: 20px;\n          padding-right: 20px;\n        }\n        \n        .roland-ui-mods-post-group {\n            background: white;\n            border-radius: 5px;\n            border: 2px solid #ddd;\n            margin-top: 10px;\n            padding: 5px;\n        }\n        .roland-component-expandable-image {\n            cursor: pointer;\n        }"),GM_addStyle(".dimmer-roland-component-loading-indicator {\n            position: absolute;\n            width: 100%;\n            height: calc(100% - 0px);\n            display: none;\n            z-index: 9998;\n            background: rgba(0, 0, 0, 0.2);\n        }\n        \n        .loader-roland-component-loading-indicator {\n            display: none;\n            position: absolute;\n            z-index: 9999;\n            border: 2px solid #f3f3f3;\n            border-radius: 50%;\n            border-top: 2px solid #3498db;\n            width: 60px;\n            height: 60px;\n            margin-left: -30px;\n            margin-top: 60px;\n            left: 50%;\n            -webkit-animation: roland-component-loader-spin 0.3s linear infinite; /* Safari */\n            animation: roland-component-loader-spin 0.3s linear infinite;\n          }\n\n          .roland-component-image-loading-indicator {\n            border: 2px solid #f3f3f3;\n            border-radius: 50%;\n            border-top: 2px solid #3498db;\n            width: 20px;\n            height: 20px;\n            -webkit-animation: roland-component-loader-spin 0.3s linear infinite; /* Safari */\n            animation: roland-component-loader-spin 0.3s linear infinite;\n          }\n          \n          /* Safari */\n          @-webkit-keyframes roland-component-loader-spin {\n            0% { -webkit-transform: rotate(0deg); }\n            100% { -webkit-transform: rotate(360deg); }\n          }\n          \n          @keyframes roland-component-loader-spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }"),GM_addStyle('\n        #roland-component-timesheets-container .job-queue-container {\n            position: absolute;\n            right: 0%;\n            top: 40px;\n            width: 20%;\n            padding: 1em;\n        }\n        #roland-component-timesheets-container .job-card {\n            width: 20%;\n            padding: 1em;\n        }\n        #roland-component-timesheets-container .job-card-content {\n            text-align: center;\n        }\n        #roland-component-timesheets-container .job-card-content-element {\n            padding: 0.5em;\n        }\n        #roland-component-timesheets-container .job-card-indicator {\n            margin-top: 0.5em;\n            display: inline-block;\n            width: 100%;\n            text-align: -webkit-center;\n        }\n        #roland-component-timesheets-container .roland-component-job-success-indicator {\n            border: 2px solid green;\n            border-radius: 50%;\n            width: 20px;\n            height: 20px;\n        }\n        #roland-component-timesheets-container .roland-component-job-failure-indicator {\n            border: 2px solid red;\n            border-radius: 50%;\n            width: 20px;\n            height: 20px;\n            cursor: pointer;\n        }\n        #roland-component-timesheets-container .roland-component-job-loading-indicator {\n            border: 2px solid #f3f3f3;\n            border-radius: 50%;\n            border-top: 2px solid #3498db;\n            width: 20px;\n            height: 20px;\n            -webkit-animation: roland-component-loader-spin 0.3s linear infinite;\n            /* Safari */\n            animation: roland-component-loader-spin 0.3s linear infinite;\n        }\n        \n        /* Safari */\n        @-webkit-keyframes roland-component-loader-spin {\n            0% {\n                -webkit-transform: rotate(0deg);\n            }\n        \n            100% {\n                -webkit-transform: rotate(360deg);\n            }\n        }\n        \n        @keyframes roland-component-loader-spin {\n            0% {\n                transform: rotate(0deg);\n            }\n        \n            100% {\n                transform: rotate(360deg);\n            }\n        }\n\n\n\n\n          #roland-component-timesheets-container .searchable-picklist-container-inner {\n            max-height: 2.2em;\n            display: inline-block;\n        }\n        #roland-component-timesheets-container .searchable-picklist-result {\n            box-sizing: border-box;\n            padding: 0.6em;\n            width: 25em;\n            height: 2.2em;\n            text-align: left;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            overflow: hidden;\n        }\n        #roland-component-timesheets-container .searchable-picklist-result:hover {\n            background-color: #eee;\n        }\n        #roland-component-timesheets-container .searchable-picklist-results {\n            cursor: pointer;\n            display: block;\n            position: absolute;\n            z-index: 9000;\n            background-color: white;\n            box-shadow: 0 2px 12px 0 rgba(30, 30, 30, 0.08);\n        }\n        #roland-component-timesheets-container .searchable-picklist-result-selected {\n            background-color: #eee;\n        }\n\n\n\n\n\n        #roland-component-timesheets-container {\n            margin: 0;\n        }\n\n\n\n\n        #roland-component-timesheets-container #container {\n            text-align: center;\n        }\n\n        .ui-datepicker-month {\n            color: #333;\n        }\n        .ui-datepicker-year {\n            color: #333;\n        }\n        .ui-widget-header {\n            background: #b60001 !important;\n            border: none !important;\n        }\n        .ui-state-hover {\n            background: #eee !important;\n            border: #780009 !important;\n            color: #780009 !important;\n        }\n        @font-face {\n            font-family: avenir;\n            src: url("fonts/avenir-light.otf") format("opentype");\n        }\n        @font-face {\n            font-family: avenir;\n            font-weight: bold;\n            src: url("fonts/avenir-light.otf") format("opentype");\n        }\n        #roland-component-timesheets-container .hours-logging-form-input {\n            margin-right: 0em;\n        }\n        #roland-component-timesheets-container input {\n            display: inline-block;\n            background-color: #f5f5f5;\n            color: inherit;\n            outline: none;\n            resize: none;\n            box-sizing: border-box;\n            border: 1px solid lightgray;\n            box-shadow: none;\n            font-family: inherit;\n            font-size: inherit;\n            font-weight: inherit;\n            padding: 0.6em;\n            margin-right: 0.6em;\n            min-width: 25em;\n            margin-top: 20px;\n        }\n        #roland-component-timesheets-container label {\n            padding: 0.6em;\n            display: inline-block;\n            width: 9em;\n            text-align: right;\n        }\n        #roland-component-timesheets-container textarea {\n            display: inline-block;\n            background-color: #f5f5f5;\n            color: inherit;\n            outline: none;\n            resize: none;\n            box-sizing: border-box;\n            border: 1px solid lightgray;\n            box-shadow: none;\n            font-family: inherit;\n            font-size: inherit;\n            font-weight: inherit;\n            padding: 0.6em;\n            margin-right: 0.6em;\n            min-width: 25em;\n            height: 15em;\n            margin-top: 20px;\n        }\n        #roland-component-timesheets-container button:focus {\n            background-color: #780009;\n        }\n        #roland-component-timesheets-container button:focus:hover {\n            background-color: #780009;\n        }\n        #roland-component-timesheets-container button:hover {\n            background-color: #780009;\n        }\n        #roland-component-timesheets-container textarea:focus {\n            border-color: #b60001;\n            background-color: white;\n        }        \n        #roland-component-timesheets-container input:focus {\n            border-color: #b60001;\n            background-color: white;\n        }        \n        #roland-component-timesheets-container button:focus:hover,textarea:focus:hover,input:focus:hover {\n            border-color: #b60001;\n        }\n        #roland-component-timesheets-container textarea:hover,input:hover {\n            border-color: #780009;\n        }\n        #roland-component-timesheets-container button {\n            display: inline-block;\n            cursor: pointer;\n            background-color: #b60001;\n            color: white;\n            outline: none;\n            border: 0px solid lightgray;\n            box-sizing: border-box;\n            box-shadow: none;\n            font-family: inherit;\n            font-size: inherit;\n            font-weight: inherit;\n            padding: 0.6em;\n            margin-right: 0.6em;\n            min-width: 25em;\n            margin-top: 20px;\n        }\n\n\n\n\n        #roland-component-timesheets-container .timesheet-input-form-container {\n            background-color: #abc2cf;\n            position: fixed;\n            left: 50%;\n            top: 40%;\n            transform: translate(-50%, -50%);\n            padding: 2em;\n        }')};showWhosLooking=()=>{setTimeout((()=>{this.whosLookingText!=GLOBAL.whosLookingText&&(this.whosLookingText=GLOBAL.whosLookingText),GLOBAL.whosLookingResponse&&(this.whosLookingResponseTimestamp=GLOBAL.whosLookingResponse.timestamp,this.injectWhosLookingIndicator()),this.showWhosLooking()}),1e3)};injectWhosLookingIndicator=()=>{let t=$("div.feedActions.slds-grid");$(".roland-ui-mods-whoslooking-indicator").remove();for(let e in GLOBAL.whosLookingResponse.response){let n=GLOBAL.whosLookingResponse.response[e],i=~~(Date.now()/1e3)-~~(n.lastActivityTimestamp/1e3),s=100,o=300,a=1-.8*(i/s<1?i/s:1);t.prepend(this.whosLookingIndicatorTemplate({title:`${n.name} was active on this case ${i}s ago`,initials:this.nameToInitials(n.name),opacity:a,show:!(o<i),isTyping:Date.now()-n.lastKeypressTimestamp<5e3,backgroundColor:n.backgroundColor}))}};nameToInitials=t=>{let e=t.split(" "),n="";for(let t in e)n+=e[t].charAt(0);return n.toUpperCase()};setUserName=t=>{this.userName=t,this.injectSettingsButton(),this.showWhosLooking()};whosLookingIndicatorTemplate=t=>t.show?`<div class='roland-ui-mods-whoslooking-indicator' style='opacity: ${t.opacity}; background-color: ${t.backgroundColor}' title='${t.title}'>\n        <div>${t.initials}</div>\n           <div class="ticontainer ${t.isTyping?"":"roland-hide"}">\n               <div class="tiblock">\n                   <div class="tidot"></div>\n                   <div class="tidot"></div>\n                   <div class="tidot"></div>\n               </div>\n           </div>\n       </div>`:"";settingsButtonTemplate=()=>"<div class=\"big-blue-button\" id='roland-ui-mods-settings-button'>Service Cloud Premium</div>";timesheetsButtonTemplate=()=>GLOBAL.enableTimesheetsForUsers.includes(this.userName.toLowerCase())?"<div class=\"big-blue-button\" id='roland-ui-mods-timesheets-button'>Timesheets</div>":"";chatButtonTemplate=()=>"<div class=\"big-blue-button\" id='roland-ui-mods-chat-button'>Chat</div>";headerButtonsTemplate=()=>`<div id="roland-ui-mods-header-buttons">${this.settingsButtonTemplate()}${this.timesheetsButtonTemplate()}</div>`;settingsMenuTemplate=()=>`<div class="roland-ui-mods-form">\n        <div class="roland-ui-mods-form-heading">Release notes for version: ${GLOBAL.version}</div>\n        <ul>\n          <li>&bull;&nbsp;Fixed status highlighting in lists. There was a bug in the v20240209 (Feb 9th) release.<br><br>\n          <li>&bull;&nbsp;Chat BETA - new way to handle internal communications in the feed.<br><br>\n          <li>&bull;&nbsp;Timesheet module V1 BETA for AdaptiveWork TAMs.<br><br>\n        </ul>\n        <br>\n  \n        <div class="roland-ui-mods-form-heading">Settings</div>\n        <form>\n          <label><span>Avatar color</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="avatarColor" id="avatar-color-input" value="${GLOBAL.settingsManager.settings.avatarColor}"/></label>\n          <label><span>Scrollbar width</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="scrollbarWidth" id="scrollbar-width-input" value="${GLOBAL.settingsManager.settings.scrollbarWidth}"/></label>\n          <label><span>Auto-click "Internal Only"</span><input class="roland-ui-mods-settings-input" data-id="autoClickInternalUpdatesTab" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.autoClickInternalUpdatesTab)?"checked":""}/></label>\n          <label><span>Disable list refresh</span><input class="roland-ui-mods-settings-input" data-id="disableListRefresh" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.disableListRefresh)?"checked":""}/></label>\n          <label><span>List refresh rate (in seconds)</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="listRefreshRate" value="${GLOBAL.settingsManager.settings.listRefreshRate}"/></label>\n          <label><span>Report refresh rate (in seconds)</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="reportRefreshRate" value="${GLOBAL.settingsManager.settings.reportRefreshRate}"/></label>\n          <label><span>Use CTRL+Q to close all tabs</span><input class="roland-ui-mods-settings-input" data-id="closeAllTabsUsingCtrlQ" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.closeAllTabsUsingCtrlQ)?"checked":""}/></label>\n          <label><span>Use CTRL+I to open all images</span><input class="roland-ui-mods-settings-input" data-id="openAllImagesUsingCtrlI" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.openAllImagesUsingCtrlI)?"checked":""}/></label>\n          <label><span>Hyperlink URLs when possible (<span style="text-decoration: underline; color: blue;" title='If you notice issues with links not working, please disable and refresh.'>info</span>)</span><input class="roland-ui-mods-settings-input" data-id="allUrlHyperlinkingBeta" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.allUrlHyperlinkingBeta)?"checked":""}/></label>\n          <label><span>Support Score red threshold</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="ssRedThreshold" value="${GLOBAL.settingsManager.settings.ssRedThreshold}"/></label>\n          <label><span>Support Score orange threshold</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="ssOrangeThreshold" value="${GLOBAL.settingsManager.settings.ssOrangeThreshold}"/></label>\n          <label><span>Support Score yellow threshold</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="ssYellowThreshold" value="${GLOBAL.settingsManager.settings.ssYellowThreshold}"/></label>\n          <label><span>Override standard feed font (<span style="text-decoration: underline; color: blue;" title='If disabled, below feed font settings will not be applied.'>info</span>)</span><input class="roland-ui-mods-settings-input" data-id="overrideStandardFeedFont" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.overrideStandardFeedFont)?"checked":""}/></label>\n          <label><span>Custom feed font (<span style="text-decoration: underline; color: blue;" title='If a valid and available font is entered it will be used instead of the below feed font selected in the picklist.'>info</span>)</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="customFeedFont" value="${GLOBAL.settingsManager.settings.customFeedFont}"/></label>\n          <label><span>Feed font (<span style="text-decoration: underline; color: blue;" title='This will be used if custom feed font is blank'>info</span>)</span><div style='display:inline-block;'><div>${this.feedFontSelectorHTML(GLOBAL.settingsManager.settings.feedFontFamily)}</div><div id='abcxyz' style='padding-top:10px;font-family:${GLOBAL.settingsManager.settings.feedFontFamily};'>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</div></div></label>\n          <label><span>Feed font size</span><input type="text" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="feedFontSize" value="${GLOBAL.settingsManager.settings.feedFontSize}"/></label>\n          <label><span>Hide empty milestones</span><input class="roland-ui-mods-settings-input" data-id="hideEmptyMilestones" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.hideEmptyMilestones)?"checked":""}/></label>\n          <label><span>Use the new Chat module (<span style="text-decoration: underline; color: blue;" title='Once enabled and refreshed, you should see a new option to view case feed alongside "All Updates", "Internal Only", etc. Daily authentication will be required. Please report any issues to Roland (rpumputis@planview.com)'>BETA</span>)</span><input class="roland-ui-mods-settings-input" data-id="enableChatModule" type="checkbox" ${JSON.parse(GLOBAL.settingsManager.settings.enableChatModule)?"checked":""}/></label>\n          <label><span>Text match styles</span><textarea class="roland-ui-mods-textarea-field  roland-ui-mods-settings-input" data-id="textMatchStyles">${JSON.stringify(JSON.parse(GLOBAL.settingsManager.settings.textMatchStyles),void 0,4)}</textarea></label>\n        </form>\n      </div>`;feedFontSelectorHTML=t=>{const e=[];for(let t in GLOBAL.availableFonts)e.push({name:GLOBAL.availableFonts[t],selected:!1});return`<select id="feed-font-selector" class="roland-ui-mods-input-field roland-ui-mods-settings-input" data-id="feedFontFamily">\n                    ${e.map((e=>(e.selected=e.name==t,e))).map((t=>this.feedFontOptionHTML(t)))}\n                </select>`};feedFontOptionHTML=t=>`<option value="${t.name}" ${t.selected?'selected ="selected"':""}>${t.name}</option>`;injectSettingsButton=t=>{$("div.slds-global-header > div:nth-child(1)").length>0?(GLOBAL.headerFound=!0,$("div.slds-global-header > div:nth-child(1)").after(this.headerButtonsTemplate())):t?console.log("failed to find the header..."):setTimeout((()=>{this.injectSettingsButton(!0)}),1e4)};uiEvents=()=>{$(document).ready((()=>{$(document).off("click","#roland-ui-mods-settings-button").on("click","#roland-ui-mods-settings-button",(t=>{this.settingsButtonClicked(t)})),$(document).off("click","#roland-ui-mods-timesheets-button").on("click","#roland-ui-mods-timesheets-button",(t=>{this.timesheetsButtonClicked(t)})),$(document).off("click","#roland-ui-mods-chat-button").on("click","#roland-ui-mods-chat-button",(t=>{})),$(document).off("click",".roland-ui-mods-chat-button-general").on("click",".roland-ui-mods-chat-button-general",(async t=>{const e=$(t.target).closest(".roland-ui-mods-chat-button-general").attr("id").split("-").slice(-1),n=$(t.target).closest("div.forceChatterStyle").find("div.cuf-feed");n.hide(),n.after(`<div class="roland-ui-mods-chat-container-general roland-ui-mods-chat-container-${e}" style="min-height:300px;"></div>`),GLOBAL.chatSummary=new ChatSummary(`div.roland-ui-mods-chat-container-${e}`,GLOBAL.activeCaseId)})),$(document).off("click",".tabs__item:not(.roland-ui-mods-chat-button-general)").on("click",".tabs__item:not(.roland-ui-mods-chat-button-general)",(t=>{$(t.target).closest("div.forceChatterStyle").find("div.cuf-feed").show(),$(`div.roland-ui-mods-chat-container-${GLOBAL.activeCaseId}`).remove()})),$(document).off("click","#feed-font-selector").on("click","#feed-font-selector",(t=>{$("#abcxyz").css("fontFamily",t.target.value)})),document.addEventListener("mousemove",this.saveMouseMovementTime,!1),document.addEventListener("keydown",this.saveKeypressTime)})),document.onkeydown=this.keyPress};keyPress=t=>{let e=window.event?event:t;if(81==e.keyCode&&e.ctrlKey&&GLOBAL.settingsManager.settings.closeAllTabsUsingCtrlQ&&this.closeTabs(),73==e.keyCode&&e.ctrlKey&&GLOBAL.settingsManager.settings.openAllImagesUsingCtrlI){let t=$('a[href*="AttachedContentDocuments"] .view-all-label');GLOBAL.fileLinks?this.openImages():t.length>0&&(t.click(),this.waitForFileLinks())}};waitForFileLinks=async()=>{GLOBAL.fileLinks||(GLOBAL.fileLinks=await new Promise((t=>{GLOBAL.imageUrlResolvedCallback=t}))),this.openImages()};tryToFindFileLinks=()=>{console.log("trying to find links");let t=$("a:not('.tabHeader')[href*=\"/ContentDocument/\"] span.itemTitle.desktop");t.length>0&&(GLOBAL.fileLinks=t),console.log(t)};openImages=async()=>{GLOBAL.attachedImageUrls=[];let t=[];GLOBAL.fileLinks.each(((e,n)=>{t.push(n)}));for(let e in t){t[e].click(),await new Promise((t=>{GLOBAL.imageUrlResolvedCallback=t})),$('div.forceContentBasePreviewToolbar button[title="Close"]').click()}let e=this.addImagesToDiv(GLOBAL.imageContainerDiv,GLOBAL.attachedImageUrls);this.showImagePopup(e)};showImagePopup=t=>{let e={title:"Images",content:`<div style="padding: 15px;text-align:center;">${t}</div>`,buttons:{Close:{handler:null}},keyEvents:{13:{handler:null},27:{handler:null}},dim:!0,expandStepDuration:500,collapseStepDuration:300,expandCallback:null,collapseCallback:this.closeFilesTab},n=new Popup(e);n.keyEvents[13].handler=n.collapse,n.keyEvents[27].handler=n.collapse,n.buttons.Close.handler=n.collapse,$("body").append('<div id="roland-ui-mods-image-viewer-popup" style="padding:5px;position:fixed;width:90%;height:90%;top:5%;left:5%;z-index:9000;"></div>'),n.render("roland-ui-mods-image-viewer-popup"),n.expand()};closeFilesTab=()=>{GLOBAL.fileTabCloseButton&&GLOBAL.fileTabCloseButton.click(),console.log("close")};addImagesToDiv=(t,e)=>{let n="";for(let t in e)n+=`<img style="border: 1px solid #333;" src='${e[t]}'><br><br>`;return t.html(n),this.styleDiv(t),n};styleDiv=t=>{t.css({display:"block",overflow:"scroll","text-align":"center",padding:"100px"})};closeTabs=()=>{let t=$('button.slds-button.slds-button_icon.slds-button_icon-x-small.slds-button_icon-container[title^="Close "]');t.length>0&&t.click()};toggleWidenModeButtonClicked=()=>{console.log("toggle");let t=$('a:contains("Contact Details")');this.toggleOffsetAncestor(t,"[id^='leftColumn-']")};toggleOffsetAncestor=(t,e)=>(console.log(t),t.is(e)?(console.log("toggling"),t.hide(),t.next().css("width","100%"),!0):t.offsetParent().length>0?(console.log("looking deeper"),this.toggleOffsetAncestor(t.offsetParent(),e)):(console.log("fail"),!1));saveMouseMovementTime=()=>{GLOBAL.mouseMovedOn=Date.now()};saveKeypressTime=()=>{GLOBAL.keyPressedOn=Date.now()};getAvailableFonts=async()=>{const t=new Set(["Arial","Arial Black","Bahnschrift","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Ebrima","Franklin Gothic Medium","Gabriola","Gadugi","Georgia","HoloLens MDL2 Assets","Impact","Ink Free","Javanese Text","Leelawadee UI","Lucida Console","Lucida Sans Unicode","Malgun Gothic","Marlett","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Mongolian Baiti","MS Gothic","MV Boli","Myanmar Text","Nirmala UI","Palatino Linotype","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Historic","Segoe UI Emoji","Segoe UI Symbol","SimSun","Sitka","Sylfaen","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Copperplate","Courier","Courier New","Didot","DIN Alternate","DIN Condensed","Futura","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","Impact","Lucida Grande","Luminari","Marker Felt","Menlo","Microsoft Sans Serif","Monaco","Noteworthy","Optima","Palatino","Papyrus","Phosphate","Rockwell","Savoye LET","SignPainter","Skia","Snell Roundhand","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Zapfino"].sort());await document.fonts.ready;const e=new Set;for(const n of t.values())document.fonts.check(`12px "${n}"`)&&e.add(n);return GLOBAL.availableFonts=[...e.values()],GLOBAL.availableFonts};chatButtonClicked=async t=>{let e=new Popup({title:"Chat Summary",content:'<div id="roland-ui-mods-chat-summary-popup" style="height:100%;padding: 0px;"></div>',buttons:{Close:{handler:null}},keyEvents:{13:{handler:null},27:{handler:null}},dim:!0,expandStepDuration:500,collapseStepDuration:300,expandCallback:null,collapseCallback:null});e.keyEvents[27].handler=e.collapse,$("body").append('<div id="roland-ui-mods-chat-popup" style="padding:5px;position:fixed;width:70%;height:70%;top:15%;left:15%;z-index:9000;"></div>'),e.render("roland-ui-mods-chat-popup"),e.expand(t)};settingsButtonClicked=async t=>{await this.getAvailableFonts();let e={title:`Service Cloud Premium ${GLOBAL.version}`,content:`<div style="padding: 15px;">${this.settingsMenuTemplate()}</div>`,buttons:{Cancel:{handler:null},Save:{handler:null}},keyEvents:{13:{handler:null},27:{handler:null}},dim:!0,expandStepDuration:500,collapseStepDuration:300,expandCallback:null,collapseCallback:null},n=new Popup(e);n.keyEvents[27].handler=n.collapse,n.buttons.Save.handler=partial(this.saved,n.collapse),$("body").append('<div id="roland-ui-mods-settings-popup" style="padding:5px;position:fixed;width:70%;height:70%;top:15%;left:15%;z-index:9000;"></div>'),n.render("roland-ui-mods-settings-popup"),n.expand(t)};timesheetsButtonClicked=async t=>{const e="roland-component-timesheets-container",n={title:`Timesheets for ${this.userName}`,content:`<div style="padding: 15px;"><div id="${e}"></div></div>`,buttons:{Close:{handler:null}},keyEvents:{13:{handler:null},27:{handler:null}},dim:!0,expandStepDuration:500,collapseStepDuration:300,expandCallback:partial(this.handleTimesheetAppOpening,e),collapseCallback:null};let i=new Popup(n);i.buttons.Close.handler=i.collapse,$("body").append('<div id="roland-ui-mods-timesheets-popup" style="padding:5px;position:fixed;width:96%;height:96%;top:2%;left:2%;z-index:9000;"></div>'),i.render("roland-ui-mods-timesheets-popup"),i.expand(t)};createKey=t=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i=0;for(;i<t;)e+=n.charAt(Math.floor(62*Math.random())),i+=1;return e};authenticateButton=()=>{let t="planview--bizappspro.sandbox";"prd"==this.environment&&(t="planview");this.user=GLOBAL.settingsManager.settings.userName,this.userKey=this.createKey(64),this.caseId=GLOBAL.activeCaseId;const e=`${this.user};${this.caseId};${this.userKey}`,n=`https://${t}.my.salesforce.com/services/oauth2/authorize?client_id=${"prd"==this.environment?GLOBAL.SFDCappClientIdPrd:GLOBAL.SFDCappClientId}&redirect_uri=https://servicecloudpremium-781150c5a240.herokuapp.com/sfdcauth&response_type=code&state=${e}`;return`<div style="padding:15px;"><a class='big-blue-button' id='roland-ui-mods-authenticate-button-${this.userKey}' href="${n}" target="_blank">Authenticate</a></div>`};waitForCookie=async(t,e,n)=>new Promise((async i=>{console.log("current attempt:",n),n<e?setTimeout((async()=>{const s=await asyncRequest("GET",`https://servicecloudpremium-781150c5a240.herokuapp.com/getcookie?userKey=${this.userKey}&user=${this.user}`,{});console.log(s),s.authenticated?i({success:!0,message:"Got a cookie!"}):i(this.waitForCookie(t,e,n+1))}),t):i({success:!1,message:"no cookie :("})}));handleTimesheetAppOpening=async t=>{const e=await asyncRequest("GET","https://servicecloudpremium-781150c5a240.herokuapp.com/getTamActivities",{},{});console.log("/getTamActivities response:",e),e.success||"unauthorized"!=e.reason?this.loadTimesheetsApp(t,e):($(`#${t}`).html(this.authenticateButton()),$(document).off("click",`#roland-ui-mods-authenticate-button-${this.userKey}`).on("click",`#roland-ui-mods-authenticate-button-${this.userKey}`,(async()=>{let e=await this.waitForCookie(5e3,20,0);console.log("cookie or no cookie:",e),e.success?($(`#${t}`).html(""),this.handleTimesheetAppOpening(t)):(this.hideLoader(),$(`#${t}`).html("Authentication failed... Please refresh your browser window and try again."))})))};loadTimesheetsApp=async(t,e)=>{const n={local:e.local,activities:e.activities,additionalData:e.additionalData,types:[{name:"Documentation",id:"Documentation"},{name:"Other",id:"Other"},{name:"Troubleshooting",id:"Troubleshooting"},{name:"Status Meeting",id:"Status Meeting"},{name:"Technical Advice",id:"Technical Advice"},{name:"Configuration",id:"Configuration"},{name:"Correspondence",id:"Correspondence"},{name:"Troubleshooting Meeting",id:"Troubleshooting Meeting"},{name:"Technical Advice Meeting",id:"Technical Advice Meeting"},{name:"Configuration Meeting",id:"Configuration Meeting"},{name:"Other Meetings",id:"Other Meetings"},{name:"Planning",id:"Planning"},{name:"Planning Meeting",id:"Planning Meeting"},{name:"Testing",id:"Testing"},{name:"Logs",id:"Logs"},{name:"Proactive Work",id:"Proactive Work"},{name:"Reporting",id:"Reporting"},{name:"Monitoring",id:"Monitoring"}]},i=new JobQueueClass(t,"job-queue");new TimesheetInputFormClass(t,n,i).render()};saved=t=>{let e;$(".roland-ui-mods-settings-input").each(((t,n)=>{let i,s=$(n),o=s.attr("data-id");s.is('input[type="text"]')?i=s.val():s.is('input[type="checkbox"]')?i=s.is(":checked"):(s.is("textarea")||s.is("select"))&&(i=s.val()),e=GLOBAL.settingsManager.update(o,i)})),t()}}class LoadingIndicator{constructor(t){this.showing=!1,this.uuid=this.generateUUID(),this.classUniqueString="roland-component-loading-indicator",this.dimmerId="dimmer-"+this.uuid,this.dimmerClass="dimmer-"+this.classUniqueString,this.loaderId="loader-"+this.uuid,this.loaderClass="loader-"+this.classUniqueString,this.dimmerHtml=`<div id="${this.dimmerId}" class="${this.dimmerClass}"></div>`,this.loaderHtml=`<div id="${this.loaderId}" class="${this.loaderClass}"></div>`,$(t).prepend(this.dimmerHtml),$(t).prepend(this.loaderHtml)}show=t=>{this.showing=!0,t&&console.log(t),$("#"+this.dimmerId).show(),$("#"+this.loaderId).show()};hide=t=>{this.showing=!1,t&&console.log(t),$("#"+this.dimmerId).hide(),$("#"+this.loaderId).hide()};destroy=()=>{this.showing=!1,$("#"+this.dimmerId).remove(),$("#"+this.loaderId).remove()};generateUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}const GLOBAL={openTabs:[],tabDictionary:{},enableTimesheetsForUsers:["beata genthner","roland pumputis","vygantas grabliauskas","norbert atienza","warren moorman","sandy meehan"],SFDCappClientId:"3MVG9lIH5nSM6mjSH89So4rk1PLwk.veonz_ynw3rSMv3wbIJoW2qs3UHMbpyV6LwsXsNtx18wE80Bln2.tKi",SFDCappClientIdPrd:"3MVG9szVa2RxsqBb6xzeWJg3ccK1sEeeCkuAYiviE8Ms2ykDei58iRxEi8PAZ70tPQcVPtjRT1cSxwtWzqRA_",chatSummary:null,totalTimeSpentInRolandUImodsScript:0,totalTimeSpent:0,mutationObserverRegistry:null,activeCaseNumber:null,activeCaseId:null,activeCaseElementToHighlight:null,caseIdNumberPairs:{},activeCaseStatus:null,userName:null,profileButton:null,pathname:window.location.pathname,mouseMovedOn:null,keyPressedOn:null,headerFound:!1,imageOpenerButtonsList:{},attachedImageUrls:[],imageUrlResolvedCallback:null,imageContainerDiv:null,fileLinks:null,fileTabCloseButton:null,version:"v20240312"},rolandUImods=()=>{console.log("Service Cloud Premium version:",GLOBAL.version),GLOBAL.settingsManager=new SettingsManager,GLOBAL.mutationObserverRegistry=new MutationObserverRegistry("Global"),GLOBAL.mutationObserverRegistry.observer.observe(document.body,{subtree:!0,childList:!0,attributes:!0,characterData:!0}),GLOBAL.conditionalFormatting=new ConditionalFormatting,GLOBAL.uiInjector=new UIinjector,GLOBAL.conditionalFormatting.run(),GLOBAL.mutationObserverRegistry.addFunctionForNodeAddition(detectUserName),exposeUserName();(new WhosLooking).check(),overrideListRefreshRate(),refreshLists(),refreshReports()},overrideListRefreshRate=()=>{setTimeout((()=>{refreshListsInSeconds?refreshListsInSeconds=2e6:overrideListRefreshRate()}),1e3)},refreshLists=()=>{isNaN(parseFloat(GLOBAL.settingsManager.settings.listRefreshRate))||setTimeout((()=>{if(!GLOBAL.settingsManager.settings.disableListRefresh){let t=$($("button",$("force-list-view-manager-button-bar"))[0]);t.length>0&&t.click()}refreshLists()}),1e3*parseFloat(GLOBAL.settingsManager.settings.listRefreshRate))},refreshReports=()=>{!isNaN(parseFloat(GLOBAL.settingsManager.settings.reportRefreshRate))&&GLOBAL.settingsManager.settings.reportRefreshRate>0&&setTimeout((()=>{let t=$($(".report-action-refreshReport")[0]);t.length>0&&t.click(),refreshReports()}),1e3*parseFloat(GLOBAL.settingsManager.settings.reportRefreshRate))};function partial(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.concat(Array.prototype.slice.call(arguments));return t.apply(this,n)}}const detectUserName=t=>{const e=$(t).find("h1.profile-card-name a");e.length>0&&null!=GLOBAL.profileButton&&null==GLOBAL.settingsManager.settings.userName&&(GLOBAL.settingsManager.update("userName",e.html()),GLOBAL.uiInjector.setUserName(GLOBAL.settingsManager.settings.userName),setTimeout((()=>{GLOBAL.profileButton.click()}),100))},exposeUserName=()=>{if(null==GLOBAL.settingsManager.settings.userName){const t=$("button.branding-userProfile-button");t.length>0?(GLOBAL.profileButton=t.get(0),tryOpeningProfilePopupToLookForName()):setTimeout((()=>{exposeUserName()}),15e3)}else GLOBAL.uiInjector.setUserName(GLOBAL.settingsManager.settings.userName)},tryOpeningProfilePopupToLookForName=()=>{null==GLOBAL.settingsManager.settings.userName&&(GLOBAL.profileButton.click(),setTimeout((()=>{0==$("h1.profile-card-name").length&&tryOpeningProfilePopupToLookForName()}),15e3))};